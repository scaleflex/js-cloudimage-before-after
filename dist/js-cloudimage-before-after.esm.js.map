{"version":3,"file":"js-cloudimage-before-after.esm.js","sources":["../src/core/config.ts","../src/utils/dom.ts","../src/utils/events.ts","../src/utils/cloudimage.ts","../src/slider/slider.ts","../src/slider/handle.ts","../src/slider/gestures.ts","../src/zoom/zoom-pan.ts","../src/zoom/gestures.ts","../src/zoom/controls.ts","../src/zoom/scroll-hint.ts","../src/labels/labels.ts","../src/fullscreen/fullscreen.ts","../src/animation/entrance.ts","../src/a11y/keyboard.ts","../src/a11y/aria.ts","../src/core/ci-before-after.ts","../src/index.ts"],"sourcesContent":["import type {\n  CIBeforeAfterConfig,\n  ResolvedConfig,\n  InteractionMode,\n  Orientation,\n  HandleStyle,\n  Theme,\n  LabelPosition,\n  ZoomControlsPosition,\n} from './types';\n\nconst VALID_MODES: InteractionMode[] = ['drag', 'hover', 'click'];\nconst VALID_ORIENTATIONS: Orientation[] = ['horizontal', 'vertical'];\nconst VALID_THEMES: Theme[] = ['light', 'dark'];\nconst VALID_HANDLE_STYLES: HandleStyle[] = ['arrows', 'circle', 'line'];\nconst VALID_LABEL_POSITIONS: LabelPosition[] = ['top', 'bottom'];\nconst VALID_ZOOM_POSITIONS: ZoomControlsPosition[] = [\n  'top-left', 'top-center', 'top-right',\n  'bottom-left', 'bottom-center', 'bottom-right',\n];\n\nconst DEFAULTS: Omit<ResolvedConfig, 'beforeSrc' | 'afterSrc'> = {\n  beforeAlt: 'Before',\n  afterAlt: 'After',\n  mode: 'drag',\n  orientation: 'horizontal',\n  initialPosition: 50,\n  zoom: false,\n  zoomMax: 4,\n  zoomMin: 1,\n  theme: 'light',\n  handleStyle: 'arrows',\n  labelsEnabled: true,\n  labelBefore: 'Before',\n  labelAfter: 'After',\n  labelPosition: 'top',\n  animateEnabled: false,\n  animateDuration: 800,\n  animateDelay: 0,\n  animateEasing: 'ease-out',\n  animateOnce: true,\n  fullscreenButton: true,\n  lazyLoad: true,\n  zoomControls: true,\n  zoomControlsPosition: 'bottom-right',\n  scrollHint: true,\n  keyboardStep: 1,\n  keyboardLargeStep: 10,\n};\n\nexport function resolveConfig(config: CIBeforeAfterConfig): ResolvedConfig {\n  const labels = config.labels;\n  let labelsEnabled = true;\n  let labelBefore = 'Before';\n  let labelAfter = 'After';\n\n  if (labels === false) {\n    labelsEnabled = false;\n  } else if (typeof labels === 'object') {\n    labelBefore = labels.before ?? 'Before';\n    labelAfter = labels.after ?? 'After';\n  }\n\n  const animate = config.animate;\n  let animateEnabled = false;\n  let animateDuration = 800;\n  let animateDelay = 0;\n  let animateEasing = 'ease-out';\n\n  if (animate === true) {\n    animateEnabled = true;\n  } else if (typeof animate === 'object') {\n    animateEnabled = true;\n    animateDuration = Math.max(0, animate.duration ?? 800);\n    animateDelay = Math.max(0, animate.delay ?? 0);\n    animateEasing = animate.easing ?? 'ease-out';\n  }\n\n  const zoom = config.zoom ?? DEFAULTS.zoom;\n\n  return {\n    beforeSrc: config.beforeSrc,\n    afterSrc: config.afterSrc,\n    beforeAlt: config.beforeAlt ?? DEFAULTS.beforeAlt,\n    afterAlt: config.afterAlt ?? DEFAULTS.afterAlt,\n    mode: validateEnumWithDefault(config.mode, VALID_MODES, DEFAULTS.mode, 'mode'),\n    orientation: validateEnumWithDefault(config.orientation, VALID_ORIENTATIONS, DEFAULTS.orientation, 'orientation'),\n    initialPosition: clampPosition(config.initialPosition ?? DEFAULTS.initialPosition),\n    zoom,\n    zoomMax: Math.max(1, config.zoomMax ?? DEFAULTS.zoomMax),\n    zoomMin: Math.max(1, Math.min(config.zoomMin ?? DEFAULTS.zoomMin, config.zoomMax ?? DEFAULTS.zoomMax)),\n    theme: validateEnumWithDefault(config.theme, VALID_THEMES, DEFAULTS.theme, 'theme'),\n    handleStyle: validateEnumWithDefault(config.handleStyle, VALID_HANDLE_STYLES, DEFAULTS.handleStyle, 'handleStyle'),\n    labelsEnabled,\n    labelBefore,\n    labelAfter,\n    labelPosition: validateEnumWithDefault(config.labelPosition, VALID_LABEL_POSITIONS, DEFAULTS.labelPosition, 'labelPosition'),\n    animateEnabled,\n    animateDuration,\n    animateDelay,\n    animateEasing,\n    animateOnce: config.animateOnce ?? DEFAULTS.animateOnce,\n    fullscreenButton: config.fullscreenButton ?? DEFAULTS.fullscreenButton,\n    lazyLoad: config.lazyLoad ?? DEFAULTS.lazyLoad,\n    zoomControls: config.zoomControls ?? (zoom ? DEFAULTS.zoomControls : false),\n    zoomControlsPosition: validateEnumWithDefault(config.zoomControlsPosition, VALID_ZOOM_POSITIONS, DEFAULTS.zoomControlsPosition, 'zoomControlsPosition'),\n    scrollHint: config.scrollHint ?? (zoom ? DEFAULTS.scrollHint : false),\n    keyboardStep: Math.max(0.5, config.keyboardStep ?? DEFAULTS.keyboardStep),\n    keyboardLargeStep: Math.max(1, config.keyboardLargeStep ?? DEFAULTS.keyboardLargeStep),\n    onSlide: config.onSlide,\n    onZoom: config.onZoom,\n    onFullscreenChange: config.onFullscreenChange,\n    onReady: config.onReady,\n    aspectRatio: config.aspectRatio,\n    cloudimage: config.cloudimage,\n  };\n}\n\nfunction validateEnum<T extends string>(value: string, allowed: T[], name: string): T | undefined {\n  if ((allowed as string[]).includes(value)) return value as T;\n  console.warn(`CIBeforeAfter: Invalid ${name} \"${value}\". Allowed: ${allowed.join(', ')}`);\n  return undefined;\n}\n\nfunction validateEnumWithDefault<T extends string>(value: T | undefined, allowed: T[], defaultValue: T, name: string): T {\n  if (value === undefined) return defaultValue;\n  if ((allowed as string[]).includes(value)) return value;\n  console.warn(`CIBeforeAfter: Invalid ${name} \"${value}\". Allowed: ${allowed.join(', ')}. Using default \"${defaultValue}\".`);\n  return defaultValue;\n}\n\nexport function parseDataAttributes(el: HTMLElement): CIBeforeAfterConfig {\n  const get = (name: string): string | null => el.getAttribute(`data-ci-before-after-${name}`);\n  const getBool = (name: string): boolean | undefined => {\n    const val = get(name);\n    if (val === null) return undefined;\n    return val === 'true';\n  };\n  const getNum = (name: string): number | undefined => {\n    const val = get(name);\n    if (val === null) return undefined;\n    const n = parseFloat(val);\n    return isNaN(n) ? undefined : n;\n  };\n\n  const beforeSrc = get('before-src');\n  const afterSrc = get('after-src');\n\n  if (!beforeSrc || !afterSrc) {\n    throw new Error('CIBeforeAfter: data-ci-before-after-before-src and data-ci-before-after-after-src are required');\n  }\n\n  const config: CIBeforeAfterConfig = {\n    beforeSrc,\n    afterSrc,\n  };\n\n  const beforeAlt = get('before-alt');\n  if (beforeAlt !== null) config.beforeAlt = beforeAlt;\n\n  const afterAlt = get('after-alt');\n  if (afterAlt !== null) config.afterAlt = afterAlt;\n\n  const mode = get('mode');\n  if (mode) config.mode = validateEnum(mode, VALID_MODES, 'mode');\n\n  const orientation = get('orientation');\n  if (orientation) config.orientation = validateEnum(orientation, VALID_ORIENTATIONS, 'orientation');\n\n  const initialPosition = getNum('initial-position');\n  if (initialPosition !== undefined) config.initialPosition = initialPosition;\n\n  const zoom = getBool('zoom');\n  if (zoom !== undefined) config.zoom = zoom;\n\n  const zoomMax = getNum('zoom-max');\n  if (zoomMax !== undefined) config.zoomMax = zoomMax;\n\n  const zoomMin = getNum('zoom-min');\n  if (zoomMin !== undefined) config.zoomMin = zoomMin;\n\n  const theme = get('theme');\n  if (theme) config.theme = validateEnum(theme, VALID_THEMES, 'theme');\n\n  const handleStyle = get('handle-style');\n  if (handleStyle) config.handleStyle = validateEnum(handleStyle, VALID_HANDLE_STYLES, 'handleStyle');\n\n  const labelsAttr = getBool('labels');\n  const labelBefore = get('label-before');\n  const labelAfter = get('label-after');\n\n  if (labelsAttr === false) {\n    config.labels = false;\n  } else if (labelBefore !== null || labelAfter !== null) {\n    config.labels = {\n      before: labelBefore ?? undefined,\n      after: labelAfter ?? undefined,\n    };\n  } else if (labelsAttr === true) {\n    config.labels = true;\n  }\n\n  const labelPosition = get('label-position');\n  if (labelPosition) config.labelPosition = validateEnum(labelPosition, VALID_LABEL_POSITIONS, 'labelPosition');\n\n  const animateAttr = getBool('animate');\n  const animateDuration = getNum('animate-duration');\n  const animateDelay = getNum('animate-delay');\n  const animateEasing = get('animate-easing');\n\n  if (animateDuration !== undefined || animateDelay !== undefined || (animateEasing !== null && animateEasing !== undefined)) {\n    config.animate = {\n      duration: animateDuration,\n      delay: animateDelay,\n      easing: animateEasing ?? undefined,\n    };\n  } else if (animateAttr !== undefined) {\n    config.animate = animateAttr;\n  }\n\n  const animateOnce = getBool('animate-once');\n  if (animateOnce !== undefined) config.animateOnce = animateOnce;\n\n  const fullscreenButton = getBool('fullscreen-button');\n  if (fullscreenButton !== undefined) config.fullscreenButton = fullscreenButton;\n\n  const lazyLoad = getBool('lazy-load');\n  if (lazyLoad !== undefined) config.lazyLoad = lazyLoad;\n\n  const zoomControls = getBool('zoom-controls');\n  if (zoomControls !== undefined) config.zoomControls = zoomControls;\n\n  const zoomControlsPosition = get('zoom-controls-position');\n  if (zoomControlsPosition) config.zoomControlsPosition = validateEnum(zoomControlsPosition, VALID_ZOOM_POSITIONS, 'zoomControlsPosition');\n\n  const scrollHint = getBool('scroll-hint');\n  if (scrollHint !== undefined) config.scrollHint = scrollHint;\n\n  const keyboardStep = getNum('keyboard-step');\n  if (keyboardStep !== undefined) config.keyboardStep = keyboardStep;\n\n  const keyboardLargeStep = getNum('keyboard-large-step');\n  if (keyboardLargeStep !== undefined) config.keyboardLargeStep = keyboardLargeStep;\n\n  const aspectRatio = get('aspect-ratio');\n  if (aspectRatio !== null) config.aspectRatio = aspectRatio;\n\n  const ciToken = get('ci-token');\n  if (ciToken) {\n    config.cloudimage = {\n      token: ciToken,\n      apiVersion: get('ci-api-version') ?? undefined,\n      domain: get('ci-domain') ?? undefined,\n      limitFactor: getNum('ci-limit-factor'),\n      params: get('ci-params') ?? undefined,\n    };\n  }\n\n  return config;\n}\n\nfunction clampPosition(value: number): number {\n  if (!isFinite(value)) return 50;\n  return Math.max(0, Math.min(100, value));\n}\n","const STYLE_ID = 'ci-before-after-styles';\n\nexport function injectStyles(css: string): void {\n  if (!isBrowser()) return;\n  if (document.getElementById(STYLE_ID)) return;\n  const style = document.createElement('style');\n  style.id = STYLE_ID;\n  style.textContent = css;\n  document.head.appendChild(style);\n}\n\nexport function createElement<K extends keyof HTMLElementTagNameMap>(\n  tag: K,\n  className?: string,\n  attrs?: Record<string, string>,\n): HTMLElementTagNameMap[K] {\n  const el = document.createElement(tag);\n  if (className) el.className = className;\n  if (attrs) {\n    for (const [key, value] of Object.entries(attrs)) {\n      el.setAttribute(key, value);\n    }\n  }\n  return el;\n}\n\nexport function resolveElement(target: HTMLElement | string): HTMLElement {\n  if (typeof target === 'string') {\n    const el = document.querySelector<HTMLElement>(target);\n    if (!el) {\n      throw new Error(`CIBeforeAfter: Element not found for selector \"${target}\"`);\n    }\n    return el;\n  }\n  return target;\n}\n\nexport function isBrowser(): boolean {\n  return typeof window !== 'undefined' && typeof document !== 'undefined';\n}\n\nexport function supportsFullscreen(): boolean {\n  if (!isBrowser()) return false;\n  const doc = document as Document & {\n    webkitFullscreenEnabled?: boolean;\n  };\n  return !!(doc.fullscreenEnabled || doc.webkitFullscreenEnabled);\n}\n\nexport function requestFullscreen(el: HTMLElement): Promise<void> {\n  const elem = el as HTMLElement & {\n    webkitRequestFullscreen?: () => Promise<void>;\n  };\n  if (elem.requestFullscreen) return elem.requestFullscreen();\n  if (elem.webkitRequestFullscreen) return elem.webkitRequestFullscreen();\n  return Promise.reject(new Error('Fullscreen API not supported'));\n}\n\nexport function exitFullscreen(): Promise<void> {\n  const doc = document as Document & {\n    webkitExitFullscreen?: () => Promise<void>;\n  };\n  if (doc.exitFullscreen) return doc.exitFullscreen();\n  if (doc.webkitExitFullscreen) return doc.webkitExitFullscreen();\n  return Promise.reject(new Error('Fullscreen API not supported'));\n}\n\nexport function getFullscreenElement(): Element | null {\n  const doc = document as Document & {\n    webkitFullscreenElement?: Element;\n  };\n  return doc.fullscreenElement || doc.webkitFullscreenElement || null;\n}\n","type EventCleanup = () => void;\n\nexport class EventManager {\n  private cleanups: EventCleanup[] = [];\n\n  on<K extends keyof HTMLElementEventMap>(\n    el: HTMLElement | Window | Document,\n    event: K,\n    handler: (e: HTMLElementEventMap[K]) => void,\n    options?: AddEventListenerOptions,\n  ): void {\n    el.addEventListener(event, handler as EventListener, options);\n    this.cleanups.push(() => el.removeEventListener(event, handler as EventListener, options));\n  }\n\n  onPassive<K extends keyof HTMLElementEventMap>(\n    el: HTMLElement | Window | Document,\n    event: K,\n    handler: (e: HTMLElementEventMap[K]) => void,\n  ): void {\n    this.on(el, event, handler, { passive: true });\n  }\n\n  onNonPassive<K extends keyof HTMLElementEventMap>(\n    el: HTMLElement | Window | Document,\n    event: K,\n    handler: (e: HTMLElementEventMap[K]) => void,\n  ): void {\n    this.on(el, event, handler, { passive: false });\n  }\n\n  destroy(): void {\n    for (const cleanup of this.cleanups) {\n      cleanup();\n    }\n    this.cleanups = [];\n  }\n}\n\nexport function getPointerPosition(\n  e: MouseEvent | TouchEvent,\n  rect: DOMRect,\n): { x: number; y: number } {\n  let clientX: number;\n  let clientY: number;\n\n  if ('touches' in e) {\n    const touch = e.touches[0] || e.changedTouches?.[0];\n    if (!touch) return { x: 0, y: 0 };\n    clientX = touch.clientX;\n    clientY = touch.clientY;\n  } else {\n    clientX = e.clientX;\n    clientY = e.clientY;\n  }\n\n  return {\n    x: clientX - rect.left,\n    y: clientY - rect.top,\n  };\n}\n\nexport function getPositionPercent(\n  e: MouseEvent | TouchEvent,\n  rect: DOMRect,\n  orientation: 'horizontal' | 'vertical',\n): number {\n  const { x, y } = getPointerPosition(e, rect);\n  const dimension = orientation === 'horizontal' ? rect.width : rect.height;\n  if (dimension === 0) return 50;\n  const offset = orientation === 'horizontal' ? x : y;\n  return Math.max(0, Math.min(100, (offset / dimension) * 100));\n}\n","import type { CloudimageConfig } from '../core/types';\n\nconst TOKEN_PATTERN = /^[a-zA-Z0-9_-]+$/;\nconst DOMAIN_PATTERN = /^[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\nconst API_VERSION_PATTERN = /^v\\d+$/;\n\nfunction validateCloudimageConfig(config: CloudimageConfig): void {\n  if (!TOKEN_PATTERN.test(config.token)) {\n    throw new Error(`CIBeforeAfter: Invalid cloudimage token \"${config.token}\". Must match [a-zA-Z0-9_-]+`);\n  }\n  if (config.domain && !DOMAIN_PATTERN.test(config.domain)) {\n    throw new Error(`CIBeforeAfter: Invalid cloudimage domain \"${config.domain}\".`);\n  }\n  if (config.apiVersion && !API_VERSION_PATTERN.test(config.apiVersion)) {\n    throw new Error(`CIBeforeAfter: Invalid cloudimage apiVersion \"${config.apiVersion}\". Must be \"v\" followed by digits.`);\n  }\n}\n\nexport function buildCloudimageUrl(\n  src: string,\n  containerWidth: number,\n  config: CloudimageConfig,\n): string {\n  validateCloudimageConfig(config);\n\n  const {\n    token,\n    apiVersion = 'v7',\n    domain = 'cloudimg.io',\n    limitFactor = 100,\n    params = '',\n    devicePixelRatioList = [1, 1.5, 2],\n  } = config;\n\n  const dpr = typeof window !== 'undefined' ? window.devicePixelRatio || 1 : 1;\n  const dprList = devicePixelRatioList.length > 0 ? devicePixelRatioList : [1];\n  const closestDpr = dprList.reduce((prev, curr) =>\n    Math.abs(curr - dpr) < Math.abs(prev - dpr) ? curr : prev,\n  );\n\n  const safeLimitFactor = limitFactor > 0 ? limitFactor : 100;\n  const rawWidth = containerWidth * closestDpr;\n  const roundedWidth = Math.ceil(rawWidth / safeLimitFactor) * safeLimitFactor;\n\n  const baseUrl = `https://${token}.${domain}/${apiVersion}`;\n  // Params are expected to be valid query string segments (e.g. \"q=80&org_if_sml=1\")\n  const paramStr = params\n    ? `?${params}&w=${roundedWidth}`\n    : `?w=${roundedWidth}`;\n\n  if (src.startsWith('http://') || src.startsWith('https://')) {\n    return `${baseUrl}/${src}${paramStr}`;\n  }\n\n  return `${baseUrl}/${src}${paramStr}`;\n}\n","import type { Orientation } from '../core/types';\n\nexport interface ClipZoomInfo {\n  level: number;\n  panX: number;\n  panY: number;\n  containerWidth: number;\n  containerHeight: number;\n}\n\nexport function updateClipPath(\n  clipEl: HTMLElement,\n  position: number,\n  orientation: Orientation,\n  zoom?: ClipZoomInfo,\n): void {\n  let adjusted = position;\n\n  if (zoom && zoom.level > 1) {\n    if (orientation === 'horizontal') {\n      adjusted = position / zoom.level - zoom.panX * 100 / (zoom.level * zoom.containerWidth);\n    } else {\n      adjusted = position / zoom.level - zoom.panY * 100 / (zoom.level * zoom.containerHeight);\n    }\n    adjusted = Math.max(0, Math.min(100, adjusted));\n  }\n\n  const value = orientation === 'horizontal'\n    ? `inset(0 0 0 ${adjusted}%)`\n    : `inset(${adjusted}% 0 0 0)`;\n  clipEl.style.clipPath = value;\n  // Safari < 14 prefix (QUAL-03)\n  clipEl.style.setProperty('-webkit-clip-path', value);\n}\n\nexport function updateHandlePosition(\n  handleEl: HTMLElement,\n  position: number,\n  orientation: Orientation,\n): void {\n  if (orientation === 'horizontal') {\n    handleEl.style.left = `${position}%`;\n    handleEl.style.top = '';\n  } else {\n    handleEl.style.top = `${position}%`;\n    handleEl.style.left = '';\n  }\n}\n\nexport function clampPosition(value: number): number {\n  if (!isFinite(value)) return 50;\n  return Math.max(0, Math.min(100, value));\n}\n","import type { HandleStyle, Orientation } from '../core/types';\nimport { createElement } from '../utils/dom';\n\nconst CHEVRON_LEFT = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m15 18-6-6 6-6\"/></svg>';\nconst CHEVRON_RIGHT = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m9 18 6-6-6-6\"/></svg>';\nconst CHEVRON_UP = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m18 15-6-6-6 6\"/></svg>';\nconst CHEVRON_DOWN = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m6 9 6 6 6-6\"/></svg>';\nconst MOVE_HORIZONTAL = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"18 8 22 12 18 16\"/><polyline points=\"6 8 2 12 6 16\"/><line x1=\"2\" x2=\"22\" y1=\"12\" y2=\"12\"/></svg>';\nconst MOVE_VERTICAL = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"8 18 12 22 16 18\"/><polyline points=\"8 6 12 2 16 6\"/><line x1=\"12\" x2=\"12\" y1=\"2\" y2=\"22\"/></svg>';\n\nexport function createHandle(\n  style: HandleStyle,\n  orientation: Orientation,\n  position: number,\n): HTMLElement {\n  const handle = createElement('div', `ci-before-after-handle ci-before-after-handle--${style}`, {\n    role: 'slider',\n    'aria-valuenow': String(Math.round(position)),\n    'aria-valuemin': '0',\n    'aria-valuemax': '100',\n    'aria-label': 'Image comparison slider. Use arrow keys to adjust the before and after split position.',\n    'aria-orientation': orientation,\n    tabindex: '0',\n  });\n\n  if (orientation === 'horizontal') {\n    handle.style.left = `${position}%`;\n  } else {\n    handle.style.top = `${position}%`;\n  }\n\n  switch (style) {\n    case 'arrows':\n      buildArrowsHandle(handle, orientation);\n      break;\n    case 'circle':\n      buildCircleHandle(handle, orientation);\n      break;\n    case 'line':\n      buildLineHandle(handle);\n      break;\n  }\n\n  return handle;\n}\n\nfunction buildArrowsHandle(handle: HTMLElement, orientation: Orientation): void {\n  const line1 = createElement('div', 'ci-before-after-handle-line');\n  const grip = createElement('div', 'ci-before-after-handle-grip');\n  const line2 = createElement('div', 'ci-before-after-handle-line');\n\n  if (orientation === 'horizontal') {\n    grip.innerHTML = CHEVRON_LEFT + CHEVRON_RIGHT;\n  } else {\n    grip.innerHTML = CHEVRON_UP + CHEVRON_DOWN;\n  }\n\n  handle.append(line1, grip, line2);\n}\n\nfunction buildCircleHandle(handle: HTMLElement, orientation: Orientation): void {\n  const grip = createElement('div', 'ci-before-after-handle-grip');\n\n  if (orientation === 'horizontal') {\n    grip.innerHTML = MOVE_HORIZONTAL;\n  } else {\n    grip.innerHTML = MOVE_VERTICAL;\n  }\n\n  handle.append(grip);\n}\n\nfunction buildLineHandle(handle: HTMLElement): void {\n  const line1 = createElement('div', 'ci-before-after-handle-line');\n  const grip = createElement('div', 'ci-before-after-handle-grip ci-before-after-handle-grip--pill');\n  const line2 = createElement('div', 'ci-before-after-handle-line');\n\n  handle.append(line1, grip, line2);\n}\n","import type { InteractionMode, Orientation } from '../core/types';\nimport { EventManager, getPositionPercent } from '../utils/events';\n\nexport interface SliderGesturesCallbacks {\n  onPositionChange: (position: number) => void;\n  onDragStart: () => void;\n  onDragEnd: () => void;\n}\n\nexport class SliderGestures {\n  private events = new EventManager();\n  private containerRect: DOMRect | null = null;\n  private rafId: number | null = null;\n  private pendingPosition: number | null = null;\n  private abortController: AbortController | null = null;\n\n  constructor(\n    private container: HTMLElement,\n    private handle: HTMLElement,\n    private mode: InteractionMode,\n    private orientation: Orientation,\n    private callbacks: SliderGesturesCallbacks,\n  ) {\n    this.bind();\n  }\n\n  private bind(): void {\n    switch (this.mode) {\n      case 'drag':\n        this.bindDrag();\n        break;\n      case 'hover':\n        this.bindHover();\n        break;\n      case 'click':\n        this.bindClick();\n        break;\n    }\n  }\n\n  private bindDrag(): void {\n    this.events.on(this.handle, 'mousedown', (e: MouseEvent) => {\n      e.preventDefault();\n      this.startDrag();\n    });\n\n    this.events.on(this.handle, 'touchstart', (e: TouchEvent) => {\n      e.preventDefault();\n      this.handle.focus();\n      this.startTouchDrag();\n    }, { passive: false });\n  }\n\n  private startDrag(): void {\n    this.cleanupWindowListeners();\n    this.abortController = new AbortController();\n    const signal = this.abortController.signal;\n\n    this.containerRect = this.container.getBoundingClientRect();\n    this.callbacks.onDragStart();\n\n    const onMouseMove = (e: MouseEvent) => {\n      if (!this.containerRect) return;\n      const position = getPositionPercent(e, this.containerRect, this.orientation);\n      this.schedulePositionUpdate(position);\n    };\n\n    const onMouseUp = () => {\n      this.flushPositionUpdate();\n      this.callbacks.onDragEnd();\n      this.containerRect = null;\n      this.cleanupWindowListeners();\n    };\n\n    window.addEventListener('mousemove', onMouseMove, { signal });\n    window.addEventListener('mouseup', onMouseUp, { signal });\n  }\n\n  private startTouchDrag(): void {\n    this.cleanupWindowListeners();\n    this.abortController = new AbortController();\n    const signal = this.abortController.signal;\n\n    this.containerRect = this.container.getBoundingClientRect();\n    this.callbacks.onDragStart();\n\n    const onTouchMove = (e: TouchEvent) => {\n      if (!this.containerRect) return;\n      if (e.touches.length !== 1) return;\n      e.preventDefault();\n      const position = getPositionPercent(e, this.containerRect, this.orientation);\n      this.schedulePositionUpdate(position);\n    };\n\n    const onTouchEnd = () => {\n      this.flushPositionUpdate();\n      this.callbacks.onDragEnd();\n      this.containerRect = null;\n      this.cleanupWindowListeners();\n    };\n\n    window.addEventListener('touchmove', onTouchMove, { passive: false, signal });\n    window.addEventListener('touchend', onTouchEnd, { signal });\n    window.addEventListener('touchcancel', onTouchEnd, { signal });\n  }\n\n  private schedulePositionUpdate(position: number): void {\n    this.pendingPosition = position;\n    if (this.rafId === null) {\n      this.rafId = requestAnimationFrame(() => {\n        this.rafId = null;\n        if (this.pendingPosition !== null) {\n          this.callbacks.onPositionChange(this.pendingPosition);\n          this.pendingPosition = null;\n        }\n      });\n    }\n  }\n\n  private flushPositionUpdate(): void {\n    if (this.rafId !== null) {\n      cancelAnimationFrame(this.rafId);\n      this.rafId = null;\n    }\n    if (this.pendingPosition !== null) {\n      this.callbacks.onPositionChange(this.pendingPosition);\n      this.pendingPosition = null;\n    }\n  }\n\n  private cleanupWindowListeners(): void {\n    if (this.abortController) {\n      this.abortController.abort();\n      this.abortController = null;\n    }\n  }\n\n  private bindHover(): void {\n    this.events.on(this.container, 'mousemove', (e: MouseEvent) => {\n      const rect = this.container.getBoundingClientRect();\n      const position = getPositionPercent(e, rect, this.orientation);\n      this.schedulePositionUpdate(position);\n    });\n  }\n\n  private bindClick(): void {\n    this.events.on(this.container, 'click', (e: MouseEvent) => {\n      if (this.handle.contains(e.target as Node)) return;\n      const rect = this.container.getBoundingClientRect();\n      const position = getPositionPercent(e, rect, this.orientation);\n      this.callbacks.onPositionChange(position);\n    });\n  }\n\n  updateMode(mode: InteractionMode): void {\n    this.events.destroy();\n    this.cleanupWindowListeners();\n    this.flushPositionUpdate();\n    this.mode = mode;\n    this.bind();\n  }\n\n  updateOrientation(orientation: Orientation): void {\n    this.orientation = orientation;\n  }\n\n  destroy(): void {\n    this.cleanupWindowListeners();\n    // Discard pending position instead of flushing — avoid firing onSlide during teardown\n    if (this.rafId !== null) {\n      cancelAnimationFrame(this.rafId);\n      this.rafId = null;\n    }\n    this.pendingPosition = null;\n    this.events.destroy();\n    this.containerRect = null;\n  }\n}\n","import type { ResolvedConfig } from '../core/types';\n\nexport class ZoomPanController {\n  private zoomLevel = 1;\n  private panX = 0;\n  private panY = 0;\n  private containerWidth = 0;\n  private containerHeight = 0;\n  private transitioning = false;\n  private transitionEndCleanup: (() => void) | null = null;\n  private resizeObserver: ResizeObserver | null = null;\n\n  private onTransformChange?: () => void;\n\n  constructor(\n    private viewport: HTMLElement,\n    private container: HTMLElement,\n    private config: ResolvedConfig,\n    private onZoomChange?: (level: number) => void,\n    onTransformChange?: () => void,\n  ) {\n    this.onTransformChange = onTransformChange;\n    this.updateContainerSize();\n    this.observeResize();\n  }\n\n  private observeResize(): void {\n    if (typeof ResizeObserver === 'undefined') return;\n    this.resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        const { width, height } = entry.contentRect;\n        this.containerWidth = width;\n        this.containerHeight = height;\n      }\n    });\n    this.resizeObserver.observe(this.container);\n  }\n\n  getZoom(): number {\n    return this.zoomLevel;\n  }\n\n  getContainerSize(): { width: number; height: number } {\n    return { width: this.containerWidth, height: this.containerHeight };\n  }\n\n  setZoom(level: number, centerX?: number, centerY?: number): void {\n    const clamped = Math.max(this.config.zoomMin, Math.min(this.config.zoomMax, level));\n    if (clamped === this.zoomLevel) return;\n\n    const oldZoom = this.zoomLevel;\n    this.zoomLevel = clamped;\n\n    // Adjust pan to keep the center point fixed\n    if (centerX !== undefined && centerY !== undefined) {\n      this.panX = centerX - (centerX - this.panX) * (clamped / oldZoom);\n      this.panY = centerY - (centerY - this.panY) * (clamped / oldZoom);\n    }\n\n    this.clampPan();\n    this.applyTransform(true);\n    this.onZoomChange?.(this.zoomLevel);\n  }\n\n  zoomIn(): void {\n    this.setZoom(\n      this.zoomLevel * 1.5,\n      this.containerWidth / 2,\n      this.containerHeight / 2,\n    );\n  }\n\n  zoomOut(): void {\n    this.setZoom(\n      this.zoomLevel / 1.5,\n      this.containerWidth / 2,\n      this.containerHeight / 2,\n    );\n  }\n\n  resetZoom(): void {\n    this.zoomLevel = Math.max(1, this.config.zoomMin);\n    this.panX = 0;\n    this.panY = 0;\n    this.applyTransform(true);\n    this.onZoomChange?.(this.zoomLevel);\n  }\n\n  getPan(): { x: number; y: number } {\n    return { x: this.panX, y: this.panY };\n  }\n\n  setPan(x: number, y: number): void {\n    this.panX = x;\n    this.panY = y;\n    this.clampPan();\n    this.applyTransform(false);\n  }\n\n  pan(dx: number, dy: number): void {\n    if (this.zoomLevel <= 1) return;\n    this.panX += dx;\n    this.panY += dy;\n    this.clampPan();\n    this.applyTransform(false);\n  }\n\n  handleWheel(e: WheelEvent): void {\n    if (!e.ctrlKey && !e.metaKey) return;\n\n    e.preventDefault();\n\n    const rect = this.container.getBoundingClientRect();\n    const centerX = e.clientX - rect.left;\n    const centerY = e.clientY - rect.top;\n\n    const delta = e.deltaY > 0 ? 0.9 : 1.1;\n    this.setZoom(this.zoomLevel * delta, centerX, centerY);\n  }\n\n  toggleZoom(centerX: number, centerY: number): void {\n    const resetLevel = Math.max(1, this.config.zoomMin);\n    if (this.zoomLevel > resetLevel) {\n      this.resetZoom();\n    } else {\n      this.setZoom(Math.max(2, resetLevel * 1.5), centerX, centerY);\n    }\n  }\n\n  updateConfig(config: ResolvedConfig): void {\n    this.config = config;\n    // Re-clamp zoom level to new min/max bounds\n    const clamped = Math.max(config.zoomMin, Math.min(config.zoomMax, this.zoomLevel));\n    if (clamped !== this.zoomLevel) {\n      this.zoomLevel = clamped;\n      this.onZoomChange?.(this.zoomLevel);\n    }\n    this.clampPan();\n    this.applyTransform(false);\n  }\n\n  private updateContainerSize(): void {\n    const rect = this.container.getBoundingClientRect();\n    this.containerWidth = rect.width;\n    this.containerHeight = rect.height;\n  }\n\n  private clampPan(): void {\n    if (this.zoomLevel <= 1) {\n      this.panX = 0;\n      this.panY = 0;\n      return;\n    }\n\n    const maxPanX = this.containerWidth * (this.zoomLevel - 1);\n    const maxPanY = this.containerHeight * (this.zoomLevel - 1);\n\n    this.panX = Math.max(-maxPanX, Math.min(0, this.panX));\n    this.panY = Math.max(-maxPanY, Math.min(0, this.panY));\n  }\n\n  private applyTransform(animate: boolean): void {\n    // Clean up previous transitionend listener to prevent accumulation\n    if (this.transitionEndCleanup) {\n      this.transitionEndCleanup();\n      this.transitionEndCleanup = null;\n    }\n\n    if (animate) {\n      this.viewport.style.transition = 'transform 300ms ease';\n      this.transitioning = true;\n      const onEnd = (e: TransitionEvent) => {\n        if (e.target !== this.viewport) return; // Ignore bubbled events from children\n        this.viewport.style.transition = '';\n        this.transitioning = false;\n        this.transitionEndCleanup = null;\n        this.viewport.removeEventListener('transitionend', onEnd);\n      };\n      this.viewport.addEventListener('transitionend', onEnd);\n      this.transitionEndCleanup = () => {\n        this.viewport.removeEventListener('transitionend', onEnd);\n        this.viewport.style.transition = '';\n        this.transitioning = false;\n      };\n    } else if (!this.transitioning) {\n      this.viewport.style.transition = '';\n    }\n\n    this.viewport.style.transform =\n      `scale(${this.zoomLevel}) translate(${this.panX / this.zoomLevel}px, ${this.panY / this.zoomLevel}px)`;\n\n    this.onTransformChange?.();\n  }\n\n  destroy(): void {\n    if (this.transitionEndCleanup) {\n      this.transitionEndCleanup();\n      this.transitionEndCleanup = null;\n    }\n    this.viewport.style.transform = '';\n    this.viewport.style.transition = '';\n    this.resizeObserver?.disconnect();\n    this.resizeObserver = null;\n  }\n}\n","import { EventManager } from '../utils/events';\nimport type { ZoomPanController } from './zoom-pan';\n\nconst PAN_THRESHOLD = 3;\n\nexport class ZoomGestures {\n  private events = new EventManager();\n  private isPanning = false;\n  private lastPanX = 0;\n  private lastPanY = 0;\n  private initialPinchDistance = 0;\n  private initialPinchZoom = 1;\n  private abortController: AbortController | null = null;\n\n  constructor(\n    private container: HTMLElement,\n    private handle: HTMLElement,\n    private zoomPan: ZoomPanController,\n    private scrollHintCallback?: () => void,\n  ) {\n    this.bind();\n  }\n\n  private bind(): void {\n    // Ctrl+Wheel zoom\n    this.events.onNonPassive(this.container, 'wheel', (e: WheelEvent) => {\n      if (e.ctrlKey || e.metaKey) {\n        this.zoomPan.handleWheel(e);\n      } else if (this.zoomPan.getZoom() > 1) {\n        // Allow scroll pass-through when zoomed\n      } else {\n        this.scrollHintCallback?.();\n      }\n    });\n\n    // Double-click to toggle zoom (not on handle)\n    this.events.on(this.container, 'dblclick', (e: MouseEvent) => {\n      if (this.handle.contains(e.target as Node)) return;\n      const rect = this.container.getBoundingClientRect();\n      this.zoomPan.toggleZoom(e.clientX - rect.left, e.clientY - rect.top);\n    });\n\n    // Pan via mouse drag (only when zoomed, not on handle)\n    this.events.on(this.container, 'mousedown', (e: MouseEvent) => {\n      if (this.handle.contains(e.target as Node)) return;\n      if (this.zoomPan.getZoom() <= 1) return;\n      e.preventDefault();\n      this.startPan(e.clientX, e.clientY);\n    });\n\n    // Touch gestures (pinch + pan)\n    this.events.on(this.container, 'touchstart', (e: TouchEvent) => {\n      if (this.handle.contains(e.target as Node)) return;\n\n      if (e.touches.length === 2) {\n        e.preventDefault();\n        this.startPinch(e);\n      } else if (e.touches.length === 1 && this.zoomPan.getZoom() > 1) {\n        e.preventDefault();\n        this.startTouchPan(e);\n      }\n    }, { passive: false });\n\n    // Safari GestureEvent\n    if (typeof window !== 'undefined' && 'GestureEvent' in window) {\n      let gestureCenterX = 0;\n      let gestureCenterY = 0;\n\n      this.events.onNonPassive(this.container, 'gesturestart' as keyof HTMLElementEventMap, (e: Event) => {\n        e.preventDefault();\n        this.initialPinchZoom = this.zoomPan.getZoom();\n        const ge = e as GestureEvent & { clientX: number; clientY: number };\n        const rect = this.container.getBoundingClientRect();\n        gestureCenterX = ge.clientX - rect.left;\n        gestureCenterY = ge.clientY - rect.top;\n      });\n\n      this.events.onNonPassive(this.container, 'gesturechange' as keyof HTMLElementEventMap, (e: Event) => {\n        e.preventDefault();\n        const ge = e as GestureEvent & { clientX: number; clientY: number };\n        const rect = this.container.getBoundingClientRect();\n        this.zoomPan.setZoom(\n          this.initialPinchZoom * ge.scale,\n          ge.clientX - rect.left,\n          ge.clientY - rect.top,\n        );\n      });\n    }\n  }\n\n  private startPan(clientX: number, clientY: number): void {\n    this.cleanupWindowListeners();\n    this.abortController = new AbortController();\n    const signal = this.abortController.signal;\n\n    this.isPanning = false;\n    this.lastPanX = clientX;\n    this.lastPanY = clientY;\n    const startX = clientX;\n    const startY = clientY;\n\n    const onMouseMove = (e: MouseEvent) => {\n      const dx = e.clientX - this.lastPanX;\n      const dy = e.clientY - this.lastPanY;\n\n      // Only start panning after exceeding threshold (BUG-09)\n      if (!this.isPanning) {\n        const totalDx = e.clientX - startX;\n        const totalDy = e.clientY - startY;\n        if (Math.hypot(totalDx, totalDy) < PAN_THRESHOLD) return;\n        this.isPanning = true;\n        this.container.style.cursor = 'grabbing';\n      }\n\n      this.lastPanX = e.clientX;\n      this.lastPanY = e.clientY;\n      this.zoomPan.pan(dx, dy);\n    };\n\n    const onMouseUp = () => {\n      this.isPanning = false;\n      this.container.style.cursor = '';\n      this.cleanupWindowListeners();\n    };\n\n    window.addEventListener('mousemove', onMouseMove, { signal });\n    window.addEventListener('mouseup', onMouseUp, { signal });\n  }\n\n  private startTouchPan(e: TouchEvent): void {\n    this.cleanupWindowListeners();\n    this.abortController = new AbortController();\n    const signal = this.abortController.signal;\n\n    const touch = e.touches[0];\n    this.lastPanX = touch.clientX;\n    this.lastPanY = touch.clientY;\n\n    const onTouchMove = (e: TouchEvent) => {\n      if (e.touches.length !== 1) return;\n      e.preventDefault();\n      const touch = e.touches[0];\n      const dx = touch.clientX - this.lastPanX;\n      const dy = touch.clientY - this.lastPanY;\n      this.lastPanX = touch.clientX;\n      this.lastPanY = touch.clientY;\n      this.zoomPan.pan(dx, dy);\n    };\n\n    const onTouchEnd = () => {\n      this.cleanupWindowListeners();\n    };\n\n    window.addEventListener('touchmove', onTouchMove, { passive: false, signal });\n    window.addEventListener('touchend', onTouchEnd, { signal });\n    window.addEventListener('touchcancel', onTouchEnd, { signal });\n  }\n\n  private startPinch(e: TouchEvent): void {\n    if (e.touches.length < 2) return;\n\n    this.cleanupWindowListeners();\n    this.abortController = new AbortController();\n    const signal = this.abortController.signal;\n    const [t1, t2] = [e.touches[0], e.touches[1]];\n    this.initialPinchDistance = Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);\n    if (this.initialPinchDistance === 0) this.initialPinchDistance = 1;\n    this.initialPinchZoom = this.zoomPan.getZoom();\n\n    const rect = this.container.getBoundingClientRect();\n    const centerX = (t1.clientX + t2.clientX) / 2 - rect.left;\n    const centerY = (t1.clientY + t2.clientY) / 2 - rect.top;\n\n    const onTouchMove = (e: TouchEvent) => {\n      if (e.touches.length !== 2) return;\n      e.preventDefault();\n      const [t1, t2] = [e.touches[0], e.touches[1]];\n      const dist = Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY);\n      const scale = dist / this.initialPinchDistance;\n      this.zoomPan.setZoom(this.initialPinchZoom * scale, centerX, centerY);\n    };\n\n    const onTouchEnd = () => {\n      this.cleanupWindowListeners();\n    };\n\n    window.addEventListener('touchmove', onTouchMove, { passive: false, signal });\n    window.addEventListener('touchend', onTouchEnd, { signal });\n    window.addEventListener('touchcancel', onTouchEnd, { signal });\n  }\n\n  private cleanupWindowListeners(): void {\n    if (this.abortController) {\n      this.abortController.abort();\n      this.abortController = null;\n    }\n  }\n\n  destroy(): void {\n    this.cleanupWindowListeners();\n    this.events.destroy();\n  }\n}\n\ninterface GestureEvent extends Event {\n  scale: number;\n}\n","import type { ZoomControlsPosition } from '../core/types';\nimport { createElement } from '../utils/dom';\nimport { EventManager } from '../utils/events';\n\nconst PLUS_ICON = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M5 12h14\"/><path d=\"M12 5v14\"/></svg>';\nconst MINUS_ICON = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M5 12h14\"/></svg>';\nconst RESET_ICON = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\"/><path d=\"M3 3v5h5\"/></svg>';\n\nexport interface ZoomControlsCallbacks {\n  onZoomIn: () => void;\n  onZoomOut: () => void;\n  onReset: () => void;\n}\n\nexport interface ZoomControlsResult {\n  element: HTMLElement;\n  events: EventManager;\n}\n\nexport function createZoomControls(\n  position: ZoomControlsPosition,\n  callbacks: ZoomControlsCallbacks,\n): ZoomControlsResult {\n  const events = new EventManager();\n  const wrapper = createElement('div', `ci-before-after-zoom-controls ci-before-after-zoom-controls--${position}`);\n\n  const zoomInBtn = createElement('button', 'ci-before-after-zoom-in', {\n    type: 'button',\n    'aria-label': 'Zoom in',\n  });\n  zoomInBtn.innerHTML = PLUS_ICON;\n  events.on(zoomInBtn, 'click', callbacks.onZoomIn);\n\n  const zoomOutBtn = createElement('button', 'ci-before-after-zoom-out', {\n    type: 'button',\n    'aria-label': 'Zoom out',\n  });\n  zoomOutBtn.innerHTML = MINUS_ICON;\n  events.on(zoomOutBtn, 'click', callbacks.onZoomOut);\n\n  const resetBtn = createElement('button', 'ci-before-after-zoom-reset', {\n    type: 'button',\n    'aria-label': 'Reset zoom',\n  });\n  resetBtn.innerHTML = RESET_ICON;\n  events.on(resetBtn, 'click', callbacks.onReset);\n\n  wrapper.append(zoomInBtn, zoomOutBtn, resetBtn);\n  return { element: wrapper, events };\n}\n","import { createElement } from '../utils/dom';\n\nexport class ScrollHint {\n  private el: HTMLElement;\n  private timeout: ReturnType<typeof setTimeout> | null = null;\n\n  constructor(container: HTMLElement) {\n    this.el = createElement('div', 'ci-before-after-scroll-hint', {\n      'aria-hidden': 'true',\n    });\n\n    const isMac = typeof navigator !== 'undefined' && /Mac|iPhone|iPad|iPod/.test(navigator.userAgent);\n    this.el.textContent = isMac\n      ? '\\u2318 + scroll or pinch to zoom'\n      : 'Ctrl + scroll or pinch to zoom';\n\n    container.appendChild(this.el);\n  }\n\n  show(): void {\n    if (this.timeout) clearTimeout(this.timeout);\n\n    this.el.classList.add('ci-before-after-scroll-hint--visible');\n\n    this.timeout = setTimeout(() => {\n      this.el.classList.remove('ci-before-after-scroll-hint--visible');\n      this.timeout = null;\n    }, 1500);\n  }\n\n  destroy(): void {\n    if (this.timeout) clearTimeout(this.timeout);\n    this.el.remove();\n  }\n}\n","import type { LabelPosition, Orientation } from '../core/types';\nimport { createElement } from '../utils/dom';\n\nexport function createLabels(\n  beforeText: string,\n  afterText: string,\n  position: LabelPosition,\n  orientation: Orientation,\n): { before: HTMLElement; after: HTMLElement } {\n  const posClass = `ci-before-after-label--${position}`;\n\n  const beforeLabel = createElement('div',\n    `ci-before-after-label ci-before-after-label-before ${posClass}`,\n    { 'aria-hidden': 'true' },\n  );\n  beforeLabel.textContent = beforeText;\n\n  const afterLabel = createElement('div',\n    `ci-before-after-label ci-before-after-label-after ${posClass}`,\n    { 'aria-hidden': 'true' },\n  );\n  afterLabel.textContent = afterText;\n\n  return { before: beforeLabel, after: afterLabel };\n}\n\nexport function updateLabelVisibility(\n  beforeLabel: HTMLElement | null,\n  afterLabel: HTMLElement | null,\n  position: number,\n  orientation: Orientation,\n): void {\n  if (!beforeLabel || !afterLabel) return;\n\n  const fadeThreshold = 15;\n\n  // Before label is near the left/top edge — fade when handle is close to 0%\n  if (position < fadeThreshold) {\n    beforeLabel.classList.add('ci-before-after-label--hidden');\n  } else {\n    beforeLabel.classList.remove('ci-before-after-label--hidden');\n  }\n\n  // After label is near the right/bottom edge — fade when handle is close to 100%\n  if (position > 100 - fadeThreshold) {\n    afterLabel.classList.add('ci-before-after-label--hidden');\n  } else {\n    afterLabel.classList.remove('ci-before-after-label--hidden');\n  }\n}\n","import { createElement, supportsFullscreen, requestFullscreen, exitFullscreen, getFullscreenElement } from '../utils/dom';\nimport { EventManager } from '../utils/events';\n\nconst MAXIMIZE_ICON = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"15 3 21 3 21 9\"/><polyline points=\"9 21 3 21 3 15\"/><line x1=\"21\" x2=\"14\" y1=\"3\" y2=\"10\"/><line x1=\"3\" x2=\"10\" y1=\"21\" y2=\"14\"/></svg>';\nconst MINIMIZE_ICON = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"4 14 10 14 10 20\"/><polyline points=\"20 10 14 10 14 4\"/><line x1=\"14\" x2=\"21\" y1=\"10\" y2=\"3\"/><line x1=\"3\" x2=\"10\" y1=\"21\" y2=\"14\"/></svg>';\n\nexport class FullscreenManager {\n  private button: HTMLElement | null = null;\n  private events = new EventManager();\n  private isActive = false;\n\n  constructor(\n    private container: HTMLElement,\n    private onFullscreenChange?: (isFullscreen: boolean) => void,\n  ) {\n    if (!supportsFullscreen()) return;\n    this.createButton();\n    this.bindEvents();\n  }\n\n  private createButton(): void {\n    this.button = createElement('button', 'ci-before-after-fullscreen-btn', {\n      type: 'button',\n      'aria-label': 'Enter fullscreen',\n      'aria-pressed': 'false',\n    });\n    this.button.innerHTML = MAXIMIZE_ICON;\n    this.events.on(this.button, 'click', () => { this.toggle().catch(() => {}); });\n    this.container.appendChild(this.button);\n  }\n\n  private bindEvents(): void {\n    this.events.on(document as unknown as HTMLElement, 'fullscreenchange', () => this.handleChange());\n    this.events.on(document as unknown as HTMLElement, 'webkitfullscreenchange' as keyof HTMLElementEventMap, () => this.handleChange());\n  }\n\n  private handleChange(): void {\n    const fsElement = getFullscreenElement();\n    const wasActive = this.isActive;\n    this.isActive = fsElement === this.container;\n\n    // Only fire callback and update UI when this instance's state actually changed\n    if (wasActive === this.isActive) return;\n\n    this.container.classList.toggle('ci-before-after-container--fullscreen', this.isActive);\n\n    if (this.button) {\n      this.button.innerHTML = this.isActive ? MINIMIZE_ICON : MAXIMIZE_ICON;\n      this.button.setAttribute('aria-label', this.isActive ? 'Exit fullscreen' : 'Enter fullscreen');\n      this.button.setAttribute('aria-pressed', String(this.isActive));\n    }\n\n    this.onFullscreenChange?.(this.isActive);\n  }\n\n  async enter(): Promise<void> {\n    if (!supportsFullscreen()) return;\n    await requestFullscreen(this.container);\n  }\n\n  async exit(): Promise<void> {\n    if (!supportsFullscreen()) return;\n    if (getFullscreenElement() === this.container) {\n      await exitFullscreen();\n    }\n  }\n\n  async toggle(): Promise<void> {\n    if (this.isActive) {\n      await this.exit();\n    } else {\n      await this.enter();\n    }\n  }\n\n  getIsFullscreen(): boolean {\n    return this.isActive;\n  }\n\n  destroy(): void {\n    const wasActive = this.isActive;\n    this.events.destroy();\n    if (wasActive) {\n      this.isActive = false;\n      this.onFullscreenChange?.(false);\n      exitFullscreen().catch(() => {});\n    }\n    this.container.classList.remove('ci-before-after-container--fullscreen');\n    this.button?.remove();\n  }\n}\n","export class EntranceAnimation {\n  private observer: IntersectionObserver | null = null;\n  private hasPlayed = false;\n  private isAnimating = false;\n  private delayTimer: ReturnType<typeof setTimeout> | null = null;\n  private durationTimer: ReturnType<typeof setTimeout> | null = null;\n\n  constructor(\n    private container: HTMLElement,\n    private duration: number,\n    private delay: number,\n    private easing: string,\n    private animateOnce: boolean,\n    private onAnimate: (skipTransition: boolean) => void,\n  ) {\n    this.observe();\n  }\n\n  private observe(): void {\n    if (typeof IntersectionObserver === 'undefined') return;\n\n    this.observer = new IntersectionObserver(\n      (entries) => {\n        for (const entry of entries) {\n          if (entry.isIntersecting) {\n            if (this.animateOnce && this.hasPlayed) continue;\n            if (this.isAnimating) continue;\n            this.play();\n          }\n        }\n      },\n      { threshold: 0.3 },\n    );\n\n    this.observer.observe(this.container);\n  }\n\n  private play(): void {\n    this.hasPlayed = true;\n    this.isAnimating = true;\n\n    // Check for reduced motion preference\n    if (typeof window !== 'undefined' && window.matchMedia?.('(prefers-reduced-motion: reduce)').matches) {\n      this.onAnimate(true);\n      this.isAnimating = false;\n      if (this.animateOnce) {\n        this.observer?.disconnect();\n      }\n      return;\n    }\n\n    this.container.classList.add('ci-before-after-animate-entrance');\n    this.container.style.setProperty('--ci-before-after-animate-duration', `${this.duration}ms`);\n    this.container.style.setProperty('--ci-before-after-animate-easing', this.easing);\n\n    this.delayTimer = setTimeout(() => {\n      this.delayTimer = null;\n      this.onAnimate(false);\n\n      this.durationTimer = setTimeout(() => {\n        this.durationTimer = null;\n        this.container.classList.remove('ci-before-after-animate-entrance');\n        this.isAnimating = false;\n        if (this.animateOnce) {\n          this.observer?.disconnect();\n        }\n      }, this.duration);\n    }, this.delay);\n  }\n\n  getHasPlayed(): boolean {\n    return this.hasPlayed;\n  }\n\n  destroy(): void {\n    if (this.delayTimer) clearTimeout(this.delayTimer);\n    if (this.durationTimer) clearTimeout(this.durationTimer);\n    this.delayTimer = null;\n    this.durationTimer = null;\n    this.isAnimating = false;\n    this.container.classList.remove('ci-before-after-animate-entrance');\n    this.container.style.removeProperty('--ci-before-after-animate-duration');\n    this.container.style.removeProperty('--ci-before-after-animate-easing');\n    this.observer?.disconnect();\n    this.observer = null;\n  }\n}\n","import type { Orientation } from '../core/types';\nimport { EventManager } from '../utils/events';\n\nexport interface KeyboardCallbacks {\n  onPositionChange: (position: number) => void;\n  getPosition: () => number;\n  onZoomIn?: () => void;\n  onZoomOut?: () => void;\n  onZoomReset?: () => void;\n}\n\nexport class KeyboardHandler {\n  private events = new EventManager();\n\n  constructor(\n    private handle: HTMLElement,\n    private orientation: Orientation,\n    private step: number,\n    private largeStep: number,\n    private zoomEnabled: boolean,\n    private callbacks: KeyboardCallbacks,\n  ) {\n    this.bind();\n  }\n\n  private bind(): void {\n    this.events.on(this.handle, 'keydown', (e: KeyboardEvent) => {\n      this.handleKeyDown(e);\n    });\n  }\n\n  private handleKeyDown(e: KeyboardEvent): void {\n    // Don't hijack browser shortcuts (Ctrl+Arrow = back/forward, Alt+Arrow = history)\n    if (e.ctrlKey || e.altKey || e.metaKey) return;\n\n    const current = this.callbacks.getPosition();\n    const increment = e.shiftKey ? this.largeStep : this.step;\n    let newPosition: number | null = null;\n\n    if (this.orientation === 'horizontal') {\n      switch (e.key) {\n        case 'ArrowLeft':\n          newPosition = current - increment;\n          break;\n        case 'ArrowRight':\n          newPosition = current + increment;\n          break;\n      }\n    } else {\n      switch (e.key) {\n        case 'ArrowUp':\n          newPosition = current - increment;\n          break;\n        case 'ArrowDown':\n          newPosition = current + increment;\n          break;\n      }\n    }\n\n    switch (e.key) {\n      case 'Home':\n        newPosition = 0;\n        break;\n      case 'End':\n        newPosition = 100;\n        break;\n    }\n\n    if (newPosition !== null) {\n      e.preventDefault();\n      newPosition = Math.max(0, Math.min(100, newPosition));\n      this.callbacks.onPositionChange(newPosition);\n      return;\n    }\n\n    // Zoom shortcuts\n    if (this.zoomEnabled) {\n      switch (e.key) {\n        case '+':\n        case '=':\n          e.preventDefault();\n          this.callbacks.onZoomIn?.();\n          break;\n        case '-':\n          e.preventDefault();\n          this.callbacks.onZoomOut?.();\n          break;\n        case '0':\n          e.preventDefault();\n          this.callbacks.onZoomReset?.();\n          break;\n      }\n    }\n  }\n\n  updateConfig(orientation: Orientation, step: number, largeStep: number, zoomEnabled: boolean): void {\n    this.orientation = orientation;\n    this.step = step;\n    this.largeStep = largeStep;\n    this.zoomEnabled = zoomEnabled;\n  }\n\n  destroy(): void {\n    this.events.destroy();\n  }\n}\n","import type { Orientation } from '../core/types';\n\nexport function updateAriaValue(handle: HTMLElement, position: number): void {\n  handle.setAttribute('aria-valuenow', String(Math.round(position)));\n}\n\nexport function updateAriaOrientation(handle: HTMLElement, orientation: Orientation): void {\n  handle.setAttribute('aria-orientation', orientation);\n}\n\nexport function setContainerAria(container: HTMLElement): void {\n  container.setAttribute('role', 'group');\n  container.setAttribute('aria-label', 'Before and after image comparison');\n}\n","import type {\n  CIBeforeAfterConfig,\n  CIBeforeAfterInstance,\n  CIBeforeAfterElements,\n  ResolvedConfig,\n  SliderState,\n} from './types';\nimport { resolveConfig } from './config';\nimport { createElement, resolveElement } from '../utils/dom';\nimport { EventManager } from '../utils/events';\nimport { buildCloudimageUrl } from '../utils/cloudimage';\nimport { updateClipPath, updateHandlePosition, clampPosition, type ClipZoomInfo } from '../slider/slider';\nimport { createHandle } from '../slider/handle';\nimport { SliderGestures } from '../slider/gestures';\nimport { ZoomPanController } from '../zoom/zoom-pan';\nimport { ZoomGestures } from '../zoom/gestures';\nimport { createZoomControls } from '../zoom/controls';\nimport { ScrollHint } from '../zoom/scroll-hint';\nimport { createLabels, updateLabelVisibility } from '../labels/labels';\nimport { FullscreenManager } from '../fullscreen/fullscreen';\nimport { EntranceAnimation } from '../animation/entrance';\nimport { KeyboardHandler } from '../a11y/keyboard';\nimport { updateAriaValue, setContainerAria } from '../a11y/aria';\n\nexport class CIBeforeAfterCore implements CIBeforeAfterInstance {\n  private config: ResolvedConfig;\n  private userConfig: CIBeforeAfterConfig;\n  private state: SliderState;\n  private elements!: CIBeforeAfterElements;\n  private events = new EventManager();\n  private imageEvents = new EventManager();\n  private sliderGestures: SliderGestures | null = null;\n  private zoomPan: ZoomPanController | null = null;\n  private zoomGestures: ZoomGestures | null = null;\n  private scrollHint: ScrollHint | null = null;\n  private fullscreenManager: FullscreenManager | null = null;\n  private entranceAnimation: EntranceAnimation | null = null;\n  private keyboardHandler: KeyboardHandler | null = null;\n  private resizeObserver: ResizeObserver | null = null;\n  private zoomControlsEl: HTMLElement | null = null;\n  private zoomControlsEvents: import('../utils/events').EventManager | null = null;\n  private lazyLoadObserver: IntersectionObserver | null = null;\n  private resizeDebounceTimer: ReturnType<typeof setTimeout> | null = null;\n  private animTransitionTimer: ReturnType<typeof setTimeout> | null = null;\n  private suppressCallbacks = false;\n\n  constructor(\n    target: HTMLElement | string,\n    userConfig: CIBeforeAfterConfig,\n  ) {\n    const container = resolveElement(target);\n    this.userConfig = { ...userConfig };\n    this.config = resolveConfig(userConfig);\n\n    this.state = {\n      position: this.config.initialPosition,\n      isDragging: false,\n      zoomLevel: 1,\n      panX: 0,\n      panY: 0,\n      isReady: false,\n      isFullscreen: false,\n    };\n\n    this.buildDOM(container);\n    this.initModules();\n    this.loadImages();\n  }\n\n  // --- Public API ---\n\n  getElements() {\n    return {\n      container: this.elements.container,\n      viewport: this.elements.viewport,\n      beforeImage: this.elements.beforeImage,\n      afterImage: this.elements.afterImage,\n      handle: this.elements.handle,\n    };\n  }\n\n  setPosition(percent: number): void {\n    const clamped = clampPosition(percent);\n    this.updatePosition(clamped);\n  }\n\n  getPosition(): number {\n    return this.state.position;\n  }\n\n  setZoom(level: number): void {\n    this.zoomPan?.setZoom(level);\n  }\n\n  getZoom(): number {\n    return this.zoomPan?.getZoom() ?? 1;\n  }\n\n  resetZoom(): void {\n    this.zoomPan?.resetZoom();\n  }\n\n  enterFullscreen(): void {\n    this.fullscreenManager?.enter().catch(() => {});\n  }\n\n  exitFullscreen(): void {\n    this.fullscreenManager?.exit().catch(() => {});\n  }\n\n  isFullscreen(): boolean {\n    return this.fullscreenManager?.getIsFullscreen() ?? false;\n  }\n\n  update(newConfig: Partial<CIBeforeAfterConfig>): void {\n    // BUG-01: Merge over stored user config, not just beforeSrc/afterSrc\n    this.userConfig = { ...this.userConfig, ...newConfig };\n    const oldConfig = this.config;\n    this.config = resolveConfig(this.userConfig);\n\n    // Update images if src changed — reset loading state and re-register handlers\n    const beforeSrcChanged = this.config.beforeSrc !== oldConfig.beforeSrc;\n    const afterSrcChanged = this.config.afterSrc !== oldConfig.afterSrc;\n\n    // Detect cloudimage config changes\n    const cloudimageChanged = !shallowEqual(this.config.cloudimage, oldConfig.cloudimage);\n\n    if (beforeSrcChanged || afterSrcChanged || cloudimageChanged) {\n      // Disconnect stale lazy-load observer that captured old src values\n      if (this.lazyLoadObserver) {\n        this.lazyLoadObserver.disconnect();\n        this.lazyLoadObserver = null;\n      }\n\n      // Reset loading state for new images\n      this.state.isReady = false;\n      this.elements.container.classList.add('ci-before-after-loading');\n\n      if (beforeSrcChanged || cloudimageChanged) {\n        this.elements.beforeImage.src = this.resolveImageSrc(this.config.beforeSrc);\n      }\n      if (afterSrcChanged || cloudimageChanged) {\n        this.elements.afterImage.src = this.resolveImageSrc(this.config.afterSrc);\n      }\n\n      this.registerImageLoadHandlers(beforeSrcChanged || cloudimageChanged, afterSrcChanged || cloudimageChanged);\n\n      // Toggle ResizeObserver for cloudimage\n      if (this.config.cloudimage && !oldConfig.cloudimage) {\n        this.initResizeObserver();\n      } else if (!this.config.cloudimage && oldConfig.cloudimage) {\n        this.resizeObserver?.disconnect();\n        this.resizeObserver = null;\n      }\n    }\n\n    // Update alt attributes\n    if (this.config.beforeAlt !== oldConfig.beforeAlt) {\n      this.elements.beforeImage.setAttribute('alt', this.config.beforeAlt);\n    }\n    if (this.config.afterAlt !== oldConfig.afterAlt) {\n      this.elements.afterImage.setAttribute('alt', this.config.afterAlt);\n    }\n\n    // Update aspect ratio\n    if (this.config.aspectRatio !== oldConfig.aspectRatio) {\n      this.elements.wrapper.style.aspectRatio = this.config.aspectRatio || '';\n    }\n\n    // Update theme\n    this.elements.container.classList.toggle('ci-before-after-theme-dark', this.config.theme === 'dark');\n\n    // Update orientation classes\n    this.elements.container.classList.toggle('ci-before-after-container--horizontal', this.config.orientation === 'horizontal');\n    this.elements.container.classList.toggle('ci-before-after-container--vertical', this.config.orientation === 'vertical');\n\n    // Update mode classes\n    this.elements.container.classList.toggle('ci-before-after-container--hover-mode', this.config.mode === 'hover');\n    this.elements.container.classList.toggle('ci-before-after-container--click-mode', this.config.mode === 'click');\n\n    // Update zoom-related will-change class (QUAL-07)\n    this.elements.viewport.classList.toggle('ci-before-after-viewport--zoomable', this.config.zoom);\n\n    // Rebuild handle if style or orientation changed\n    if (this.config.handleStyle !== oldConfig.handleStyle || this.config.orientation !== oldConfig.orientation) {\n      this.rebuildHandle();\n    }\n\n    // Update slider gestures if mode or orientation changed (BUG-07)\n    if (this.config.mode !== oldConfig.mode) {\n      this.sliderGestures?.updateMode(this.config.mode);\n    }\n    if (this.config.orientation !== oldConfig.orientation) {\n      this.sliderGestures?.updateOrientation(this.config.orientation);\n    }\n\n    // Update labels only when label config changed\n    if (\n      this.config.labelsEnabled !== oldConfig.labelsEnabled ||\n      this.config.labelBefore !== oldConfig.labelBefore ||\n      this.config.labelAfter !== oldConfig.labelAfter ||\n      this.config.labelPosition !== oldConfig.labelPosition ||\n      this.config.orientation !== oldConfig.orientation\n    ) {\n      this.rebuildLabels();\n    }\n\n    // Update zoom\n    if (this.config.zoom !== oldConfig.zoom) {\n      this.rebuildZoom();\n    } else if (this.zoomPan) {\n      this.zoomPan.updateConfig(this.config);\n\n      // Handle scrollHint change independently of zoom toggle\n      if (this.config.scrollHint !== oldConfig.scrollHint) {\n        this.scrollHint?.destroy();\n        this.scrollHint = null;\n        if (this.config.scrollHint) {\n          this.scrollHint = new ScrollHint(this.elements.container);\n        }\n      }\n\n      // Handle zoomControls or zoomControlsPosition change\n      if (\n        this.config.zoomControls !== oldConfig.zoomControls ||\n        this.config.zoomControlsPosition !== oldConfig.zoomControlsPosition\n      ) {\n        this.zoomControlsEvents?.destroy();\n        this.zoomControlsEvents = null;\n        this.zoomControlsEl?.remove();\n        this.zoomControlsEl = null;\n        this.elements.container.classList.remove('ci-before-after-container--zoom-top-right');\n        this.elements.container.classList.remove('ci-before-after-container--zoom-top');\n        this.elements.container.classList.remove('ci-before-after-container--zoom-left');\n\n        if (this.config.zoomControls) {\n          const controls = createZoomControls(\n            this.config.zoomControlsPosition,\n            {\n              onZoomIn: () => this.zoomPan?.zoomIn(),\n              onZoomOut: () => this.zoomPan?.zoomOut(),\n              onReset: () => this.zoomPan?.resetZoom(),\n            },\n          );\n          this.zoomControlsEl = controls.element;\n          this.zoomControlsEvents = controls.events;\n          this.elements.container.appendChild(this.zoomControlsEl);\n          this.applyZoomPositionClasses();\n        }\n      }\n    }\n\n    // Update initial position\n    if (this.config.initialPosition !== oldConfig.initialPosition) {\n      this.updatePosition(this.config.initialPosition);\n    }\n\n    // Update fullscreen\n    if (this.config.fullscreenButton !== oldConfig.fullscreenButton) {\n      this.rebuildFullscreen();\n    }\n\n    // Update entrance animation\n    if (this.config.animateEnabled !== oldConfig.animateEnabled) {\n      this.entranceAnimation?.destroy();\n      this.entranceAnimation = null;\n      if (this.config.animateEnabled) {\n        this.initEntranceAnimation();\n      }\n    }\n\n    // Update keyboard handler\n    this.keyboardHandler?.updateConfig(\n      this.config.orientation,\n      this.config.keyboardStep,\n      this.config.keyboardLargeStep,\n      this.config.zoom,\n    );\n\n    // Update position\n    this.updatePosition(this.state.position);\n  }\n\n  destroy(): void {\n    this.sliderGestures?.destroy();\n    this.zoomGestures?.destroy();\n    this.zoomPan?.destroy();\n    this.zoomPan = null;\n    this.scrollHint?.destroy();\n    this.fullscreenManager?.destroy();\n    this.entranceAnimation?.destroy();\n    this.keyboardHandler?.destroy();\n    this.events.destroy();\n    this.imageEvents.destroy();\n    this.resizeObserver?.disconnect();\n    this.lazyLoadObserver?.disconnect();\n    this.lazyLoadObserver = null;\n    this.zoomControlsEvents?.destroy();\n    this.zoomControlsEvents = null;\n    this.zoomControlsEl?.remove();\n    if (this.resizeDebounceTimer) clearTimeout(this.resizeDebounceTimer);\n    if (this.animTransitionTimer) clearTimeout(this.animTransitionTimer);\n\n    // SEC-03: Clear container instead of restoring unsanitized HTML\n    this.elements.container.innerHTML = '';\n    this.elements.container.removeAttribute('role');\n    this.elements.container.removeAttribute('aria-label');\n    this.elements.container.className = this.elements.container.className\n      .split(' ')\n      .filter((c) => !c.startsWith('ci-before-after'))\n      .join(' ');\n  }\n\n  // --- Private Methods ---\n\n  private buildDOM(container: HTMLElement): void {\n    container.innerHTML = '';\n\n    // Container setup\n    const orientClass = `ci-before-after-container--${this.config.orientation}`;\n    container.classList.add('ci-before-after-container', orientClass);\n\n    if (this.config.mode === 'hover') container.classList.add('ci-before-after-container--hover-mode');\n    if (this.config.mode === 'click') container.classList.add('ci-before-after-container--click-mode');\n    if (this.config.theme === 'dark') container.classList.add('ci-before-after-theme-dark');\n\n    container.classList.add('ci-before-after-loading');\n\n    setContainerAria(container);\n\n    // Viewport (receives zoom/pan transforms)\n    const viewport = createElement('div', 'ci-before-after-viewport');\n    // QUAL-07: Only set will-change when zoom is enabled\n    if (this.config.zoom) viewport.classList.add('ci-before-after-viewport--zoomable');\n\n    // Wrapper (contains images)\n    const wrapper = createElement('div', 'ci-before-after-wrapper');\n    if (this.config.aspectRatio) {\n      wrapper.style.aspectRatio = this.config.aspectRatio;\n    }\n\n    // Before image (SPEC-01: add role=\"img\")\n    const beforeImage = createElement('img', 'ci-before-after-image ci-before-after-before', {\n      alt: this.config.beforeAlt,\n      draggable: 'false',\n      role: 'img',\n    });\n\n    // Clip wrapper for after image\n    const clip = createElement('div', 'ci-before-after-clip');\n    updateClipPath(clip, this.state.position, this.config.orientation);\n\n    // After image (SPEC-01: add role=\"img\")\n    const afterImage = createElement('img', 'ci-before-after-image ci-before-after-after', {\n      alt: this.config.afterAlt,\n      draggable: 'false',\n      role: 'img',\n    });\n\n    clip.appendChild(afterImage);\n    wrapper.append(beforeImage, clip);\n    viewport.appendChild(wrapper);\n    container.appendChild(viewport);\n\n    // Handle (outside viewport for fixed positioning during zoom)\n    const handle = createHandle(this.config.handleStyle, this.config.orientation, this.state.position);\n    container.appendChild(handle);\n\n    const handleGrip = handle.querySelector('.ci-before-after-handle-grip') as HTMLElement;\n\n    // Labels\n    let labelBefore: HTMLElement | null = null;\n    let labelAfter: HTMLElement | null = null;\n\n    if (this.config.labelsEnabled) {\n      const labels = createLabels(\n        this.config.labelBefore,\n        this.config.labelAfter,\n        this.config.labelPosition,\n        this.config.orientation,\n      );\n      labelBefore = labels.before;\n      labelAfter = labels.after;\n      container.append(labelBefore, labelAfter);\n    }\n\n    this.elements = {\n      container,\n      viewport,\n      wrapper,\n      beforeImage,\n      afterImage,\n      clip,\n      handle,\n      handleGrip,\n      labelBefore,\n      labelAfter,\n    };\n  }\n\n  private initModules(): void {\n    // Slider gestures\n    this.sliderGestures = new SliderGestures(\n      this.elements.container,\n      this.elements.handle,\n      this.config.mode,\n      this.config.orientation,\n      {\n        onPositionChange: (pos) => this.updatePosition(pos),\n        onDragStart: () => this.onDragStart(),\n        onDragEnd: () => this.onDragEnd(),\n      },\n    );\n\n    // Keyboard navigation\n    this.keyboardHandler = new KeyboardHandler(\n      this.elements.handle,\n      this.config.orientation,\n      this.config.keyboardStep,\n      this.config.keyboardLargeStep,\n      this.config.zoom,\n      {\n        onPositionChange: (pos) => this.updatePosition(pos),\n        getPosition: () => this.state.position,\n        onZoomIn: () => this.zoomPan?.zoomIn(),\n        onZoomOut: () => this.zoomPan?.zoomOut(),\n        onZoomReset: () => this.zoomPan?.resetZoom(),\n      },\n    );\n\n    // Zoom\n    if (this.config.zoom) {\n      this.initZoom();\n    }\n\n    // Fullscreen\n    if (this.config.fullscreenButton) {\n      this.elements.container.classList.add('ci-before-after-container--has-fullscreen');\n      this.fullscreenManager = new FullscreenManager(\n        this.elements.container,\n        (isFullscreen) => {\n          this.state.isFullscreen = isFullscreen;\n          safeCall(this.config.onFullscreenChange, isFullscreen);\n        },\n      );\n    }\n\n    // Entrance animation\n    if (this.config.animateEnabled) {\n      this.initEntranceAnimation();\n    }\n\n    // ResizeObserver for cloudimage (QUAL-06: debounced)\n    if (this.config.cloudimage) {\n      this.initResizeObserver();\n    }\n  }\n\n  private initZoom(): void {\n    this.zoomPan = new ZoomPanController(\n      this.elements.viewport,\n      this.elements.container,\n      this.config,\n      (level) => {\n        this.state.zoomLevel = level;\n        this.syncClip();\n        safeCall(this.config.onZoom, level);\n      },\n      () => this.syncClip(),\n    );\n\n    // Scroll hint\n    if (this.config.scrollHint) {\n      this.scrollHint = new ScrollHint(this.elements.container);\n    }\n\n    // Zoom gestures\n    this.zoomGestures = new ZoomGestures(\n      this.elements.container,\n      this.elements.handle,\n      this.zoomPan,\n      () => this.scrollHint?.show(),\n    );\n\n    // Zoom controls\n    if (this.config.zoomControls) {\n      const controls = createZoomControls(\n        this.config.zoomControlsPosition,\n        {\n          onZoomIn: () => this.zoomPan?.zoomIn(),\n          onZoomOut: () => this.zoomPan?.zoomOut(),\n          onReset: () => this.zoomPan?.resetZoom(),\n        },\n      );\n      this.zoomControlsEl = controls.element;\n      this.zoomControlsEvents = controls.events;\n      this.elements.container.appendChild(this.zoomControlsEl);\n\n      this.applyZoomPositionClasses();\n    }\n  }\n\n  private applyZoomPositionClasses(): void {\n    const pos = this.config.zoomControlsPosition;\n    this.elements.container.classList.toggle('ci-before-after-container--zoom-top-right', pos === 'top-right');\n    this.elements.container.classList.toggle('ci-before-after-container--zoom-top', pos.startsWith('top-'));\n    this.elements.container.classList.toggle('ci-before-after-container--zoom-left', pos.endsWith('-left'));\n  }\n\n  private initEntranceAnimation(): void {\n    // Clear any pending animation transition timer from a previous animation\n    if (this.animTransitionTimer) {\n      clearTimeout(this.animTransitionTimer);\n      this.animTransitionTimer = null;\n      this.elements.handle.style.transition = '';\n      this.elements.clip.style.transition = '';\n    }\n\n    // Set initial position to edge for animation\n    const startPosition = 0;\n    this.suppressCallbacks = true;\n    this.updatePosition(startPosition);\n    this.suppressCallbacks = false;\n\n    this.entranceAnimation = new EntranceAnimation(\n      this.elements.container,\n      this.config.animateDuration,\n      this.config.animateDelay,\n      this.config.animateEasing,\n      this.config.animateOnce,\n      (skipTransition: boolean) => {\n        if (!skipTransition) {\n          // Animate to initial position with CSS transitions\n          this.elements.handle.style.transition =\n            `left ${this.config.animateDuration}ms ${this.config.animateEasing}, top ${this.config.animateDuration}ms ${this.config.animateEasing}`;\n          this.elements.clip.style.transition =\n            `clip-path ${this.config.animateDuration}ms ${this.config.animateEasing}`;\n        }\n\n        this.updatePosition(this.config.initialPosition);\n\n        if (!skipTransition) {\n          this.animTransitionTimer = setTimeout(() => {\n            this.animTransitionTimer = null;\n            this.elements.handle.style.transition = '';\n            this.elements.clip.style.transition = '';\n          }, this.config.animateDuration);\n        }\n      },\n    );\n  }\n\n  private loadImages(): void {\n    const beforeSrc = this.resolveImageSrc(this.config.beforeSrc);\n    const afterSrc = this.resolveImageSrc(this.config.afterSrc);\n\n    if (this.config.lazyLoad && typeof IntersectionObserver !== 'undefined') {\n      // BUG-06: Store observer for cleanup in destroy()\n      this.lazyLoadObserver = new IntersectionObserver(\n        (entries) => {\n          for (const entry of entries) {\n            if (entry.isIntersecting) {\n              this.elements.beforeImage.src = beforeSrc;\n              this.elements.afterImage.src = afterSrc;\n              this.lazyLoadObserver?.disconnect();\n              this.lazyLoadObserver = null;\n            }\n          }\n        },\n        { threshold: 0 },\n      );\n      this.lazyLoadObserver.observe(this.elements.container);\n    } else {\n      this.elements.beforeImage.src = beforeSrc;\n      this.elements.afterImage.src = afterSrc;\n    }\n\n    this.registerImageLoadHandlers(true, true);\n  }\n\n  /**\n   * Register load/error handlers for images. Cleans up previous handlers first.\n   * When only one image changed, the unchanged image is treated as already loaded.\n   */\n  private registerImageLoadHandlers(beforeChanged: boolean, afterChanged: boolean): void {\n    // Clean up previous image event handlers\n    this.imageEvents.destroy();\n\n    let beforeLoaded = !beforeChanged;\n    let afterLoaded = !afterChanged;\n\n    const checkReady = () => {\n      if (beforeLoaded && afterLoaded) {\n        this.onImagesReady();\n      }\n    };\n\n    const onBeforeLoad = () => {\n      if (!beforeLoaded) {\n        beforeLoaded = true;\n        checkReady();\n      }\n    };\n    const onAfterLoad = () => {\n      if (!afterLoaded) {\n        afterLoaded = true;\n        checkReady();\n      }\n    };\n\n    const onBeforeError = () => {\n      console.warn(`CIBeforeAfter: Failed to load image \"${this.elements.beforeImage.src}\"`);\n      if (!beforeLoaded) {\n        beforeLoaded = true;\n        checkReady();\n      }\n    };\n    const onAfterError = () => {\n      console.warn(`CIBeforeAfter: Failed to load image \"${this.elements.afterImage.src}\"`);\n      if (!afterLoaded) {\n        afterLoaded = true;\n        checkReady();\n      }\n    };\n\n    this.imageEvents.on(this.elements.beforeImage, 'load', onBeforeLoad);\n    this.imageEvents.on(this.elements.afterImage, 'load', onAfterLoad);\n    this.imageEvents.on(this.elements.beforeImage, 'error', onBeforeError);\n    this.imageEvents.on(this.elements.afterImage, 'error', onAfterError);\n\n    // Handle already cached images\n    if (this.elements.beforeImage.complete && this.elements.beforeImage.src) onBeforeLoad();\n    if (this.elements.afterImage.complete && this.elements.afterImage.src) onAfterLoad();\n  }\n\n  private onImagesReady(): void {\n    if (this.state.isReady) return;\n    this.state.isReady = true;\n\n    // Set aspect ratio from before image\n    const { naturalWidth, naturalHeight } = this.elements.beforeImage;\n    if (naturalWidth && naturalHeight) {\n      this.elements.wrapper.style.aspectRatio = `${naturalWidth} / ${naturalHeight}`;\n    }\n\n    this.elements.container.classList.remove('ci-before-after-loading');\n    safeCall(this.config.onReady);\n  }\n\n  private getClipZoomInfo(): ClipZoomInfo | undefined {\n    if (!this.zoomPan || this.zoomPan.getZoom() <= 1) return undefined;\n    const pan = this.zoomPan.getPan();\n    const size = this.zoomPan.getContainerSize();\n    return {\n      level: this.zoomPan.getZoom(),\n      panX: pan.x,\n      panY: pan.y,\n      containerWidth: size.width,\n      containerHeight: size.height,\n    };\n  }\n\n  private syncClip(): void {\n    updateClipPath(this.elements.clip, this.state.position, this.config.orientation, this.getClipZoomInfo());\n  }\n\n  private updatePosition(position: number): void {\n    this.state.position = clampPosition(position);\n    updateClipPath(this.elements.clip, this.state.position, this.config.orientation, this.getClipZoomInfo());\n    updateHandlePosition(this.elements.handle, this.state.position, this.config.orientation);\n    updateAriaValue(this.elements.handle, this.state.position);\n    updateLabelVisibility(\n      this.elements.labelBefore,\n      this.elements.labelAfter,\n      this.state.position,\n      this.config.orientation,\n    );\n    // BUG-10: Only fire callback when not suppressed (e.g. during init/animation setup)\n    if (!this.suppressCallbacks) {\n      safeCall(this.config.onSlide, this.state.position);\n    }\n  }\n\n  private onDragStart(): void {\n    this.state.isDragging = true;\n    this.elements.container.classList.add('ci-before-after-container--dragging');\n  }\n\n  private onDragEnd(): void {\n    this.state.isDragging = false;\n    this.elements.container.classList.remove('ci-before-after-container--dragging');\n  }\n\n  private resolveImageSrc(src: string): string {\n    if (this.config.cloudimage) {\n      const width = this.elements.container.getBoundingClientRect().width || 800;\n      return buildCloudimageUrl(src, width, this.config.cloudimage);\n    }\n    return src;\n  }\n\n  private rebuildHandle(): void {\n    const hadFocus = document.activeElement === this.elements.handle;\n    this.elements.handle.remove();\n    const handle = createHandle(this.config.handleStyle, this.config.orientation, this.state.position);\n    this.elements.container.appendChild(handle);\n    this.elements.handle = handle;\n    this.elements.handleGrip = handle.querySelector('.ci-before-after-handle-grip') as HTMLElement;\n\n    // Rebind modules that depend on handle\n    this.sliderGestures?.destroy();\n    this.sliderGestures = new SliderGestures(\n      this.elements.container,\n      this.elements.handle,\n      this.config.mode,\n      this.config.orientation,\n      {\n        onPositionChange: (pos) => this.updatePosition(pos),\n        onDragStart: () => this.onDragStart(),\n        onDragEnd: () => this.onDragEnd(),\n      },\n    );\n\n    this.keyboardHandler?.destroy();\n    this.keyboardHandler = new KeyboardHandler(\n      this.elements.handle,\n      this.config.orientation,\n      this.config.keyboardStep,\n      this.config.keyboardLargeStep,\n      this.config.zoom,\n      {\n        onPositionChange: (pos) => this.updatePosition(pos),\n        getPosition: () => this.state.position,\n        onZoomIn: () => this.zoomPan?.zoomIn(),\n        onZoomOut: () => this.zoomPan?.zoomOut(),\n        onZoomReset: () => this.zoomPan?.resetZoom(),\n      },\n    );\n\n    if (this.zoomGestures && this.zoomPan) {\n      this.zoomGestures.destroy();\n      this.zoomGestures = new ZoomGestures(\n        this.elements.container,\n        this.elements.handle,\n        this.zoomPan,\n        () => this.scrollHint?.show(),\n      );\n    }\n\n    // Restore keyboard focus if it was on the old handle\n    if (hadFocus) {\n      this.elements.handle.focus();\n    }\n  }\n\n  private rebuildLabels(): void {\n    this.elements.labelBefore?.remove();\n    this.elements.labelAfter?.remove();\n    this.elements.labelBefore = null;\n    this.elements.labelAfter = null;\n\n    if (this.config.labelsEnabled) {\n      const labels = createLabels(\n        this.config.labelBefore,\n        this.config.labelAfter,\n        this.config.labelPosition,\n        this.config.orientation,\n      );\n      this.elements.labelBefore = labels.before;\n      this.elements.labelAfter = labels.after;\n      this.elements.container.append(labels.before, labels.after);\n      updateLabelVisibility(labels.before, labels.after, this.state.position, this.config.orientation);\n    }\n  }\n\n  private rebuildZoom(): void {\n    this.zoomGestures?.destroy();\n    this.zoomGestures = null;\n    this.scrollHint?.destroy();\n    this.scrollHint = null;\n    this.zoomControlsEvents?.destroy();\n    this.zoomControlsEvents = null;\n    this.zoomControlsEl?.remove();\n    this.zoomControlsEl = null;\n    this.zoomPan?.destroy();\n    this.zoomPan = null;\n    this.elements.container.classList.remove('ci-before-after-container--zoom-top-right');\n    this.elements.container.classList.remove('ci-before-after-container--zoom-top');\n    this.elements.container.classList.remove('ci-before-after-container--zoom-left');\n\n    if (this.config.zoom) {\n      this.initZoom();\n    }\n  }\n\n  private rebuildFullscreen(): void {\n    this.fullscreenManager?.destroy();\n    this.fullscreenManager = null;\n    this.elements.container.classList.remove('ci-before-after-container--has-fullscreen');\n\n    if (this.config.fullscreenButton) {\n      this.elements.container.classList.add('ci-before-after-container--has-fullscreen');\n      this.fullscreenManager = new FullscreenManager(\n        this.elements.container,\n        (isFullscreen) => {\n          this.state.isFullscreen = isFullscreen;\n          safeCall(this.config.onFullscreenChange, isFullscreen);\n        },\n      );\n    }\n  }\n\n  private initResizeObserver(): void {\n    if (typeof ResizeObserver === 'undefined') return;\n\n    this.resizeObserver = new ResizeObserver(() => {\n      // QUAL-06: Debounce cloudimage resize requests\n      if (this.resizeDebounceTimer) clearTimeout(this.resizeDebounceTimer);\n      this.resizeDebounceTimer = setTimeout(() => {\n        if (this.config.cloudimage) {\n          const newBeforeSrc = this.resolveImageSrc(this.config.beforeSrc);\n          const newAfterSrc = this.resolveImageSrc(this.config.afterSrc);\n          // Only set src when URL actually changed to avoid unnecessary network requests\n          if (this.elements.beforeImage.src !== newBeforeSrc) {\n            this.elements.beforeImage.src = newBeforeSrc;\n          }\n          if (this.elements.afterImage.src !== newAfterSrc) {\n            this.elements.afterImage.src = newAfterSrc;\n          }\n        }\n        this.resizeDebounceTimer = null;\n      }, 200);\n    });\n\n    this.resizeObserver.observe(this.elements.container);\n  }\n}\n\nfunction safeCall<T extends unknown[]>(fn: ((...args: T) => void) | undefined, ...args: T): void {\n  if (!fn) return;\n  try {\n    fn(...args);\n  } catch (err) {\n    console.error('CIBeforeAfter: callback error:', err);\n  }\n}\n\nfunction shallowEqual<T extends object>(a: T | undefined, b: T | undefined): boolean {\n  if (a === b) return true;\n  if (!a || !b) return false;\n  const keysA = Object.keys(a) as (keyof T)[];\n  const keysB = Object.keys(b);\n  if (keysA.length !== keysB.length) return false;\n  for (const key of keysA) {\n    if (a[key] !== b[key]) return false;\n  }\n  return true;\n}\n","import { CIBeforeAfterCore } from './core/ci-before-after';\nimport { parseDataAttributes } from './core/config';\nimport { isBrowser, injectStyles } from './utils/dom';\nimport type { CIBeforeAfterConfig, CIBeforeAfterInstance } from './core/types';\nimport cssText from './styles/index.css?inline';\n\nexport type {\n  CIBeforeAfterConfig,\n  CIBeforeAfterInstance,\n  InteractionMode,\n  Orientation,\n  HandleStyle,\n  Theme,\n  LabelPosition,\n  ZoomControlsPosition,\n  AnimateConfig,\n  CloudimageConfig,\n  SliderState,\n} from './core/types';\n\n// QUAL-01: Export CIBeforeAfterCore for React wrapper\nexport { CIBeforeAfterCore };\n\nclass CIBeforeAfter extends CIBeforeAfterCore {\n  static autoInit(root?: HTMLElement): CIBeforeAfterInstance[] {\n    if (!isBrowser()) return [];\n    injectStyles(cssText);\n\n    const parent = root || document;\n    const elements = parent.querySelectorAll<HTMLElement>('[data-ci-before-after-before-src]');\n    const instances: CIBeforeAfterInstance[] = [];\n\n    elements.forEach((el) => {\n      const config = parseDataAttributes(el);\n      instances.push(new CIBeforeAfter(el, config));\n    });\n\n    return instances;\n  }\n\n  constructor(target: HTMLElement | string, config: CIBeforeAfterConfig) {\n    injectStyles(cssText);\n    super(target, config);\n  }\n}\n\nexport default CIBeforeAfter;\nexport { CIBeforeAfter };\n"],"names":["VALID_MODES","VALID_ORIENTATIONS","VALID_THEMES","VALID_HANDLE_STYLES","VALID_LABEL_POSITIONS","VALID_ZOOM_POSITIONS","DEFAULTS","resolveConfig","config","labels","labelsEnabled","labelBefore","labelAfter","animate","animateEnabled","animateDuration","animateDelay","animateEasing","zoom","validateEnumWithDefault","clampPosition","validateEnum","value","allowed","name","defaultValue","parseDataAttributes","el","get","getBool","val","getNum","n","beforeSrc","afterSrc","beforeAlt","afterAlt","mode","orientation","initialPosition","zoomMax","zoomMin","theme","handleStyle","labelsAttr","labelPosition","animateAttr","animateOnce","fullscreenButton","lazyLoad","zoomControls","zoomControlsPosition","scrollHint","keyboardStep","keyboardLargeStep","aspectRatio","ciToken","STYLE_ID","injectStyles","css","isBrowser","style","createElement","tag","className","attrs","key","resolveElement","target","supportsFullscreen","doc","requestFullscreen","elem","exitFullscreen","getFullscreenElement","EventManager","event","handler","options","cleanup","getPointerPosition","e","rect","_a","clientX","clientY","touch","getPositionPercent","x","y","dimension","TOKEN_PATTERN","DOMAIN_PATTERN","API_VERSION_PATTERN","validateCloudimageConfig","buildCloudimageUrl","src","containerWidth","token","apiVersion","domain","limitFactor","params","devicePixelRatioList","dpr","closestDpr","prev","curr","safeLimitFactor","rawWidth","roundedWidth","baseUrl","paramStr","updateClipPath","clipEl","position","adjusted","updateHandlePosition","handleEl","CHEVRON_LEFT","CHEVRON_RIGHT","CHEVRON_UP","CHEVRON_DOWN","MOVE_HORIZONTAL","MOVE_VERTICAL","createHandle","handle","buildArrowsHandle","buildCircleHandle","buildLineHandle","line1","grip","line2","SliderGestures","container","callbacks","signal","onMouseMove","onMouseUp","onTouchMove","onTouchEnd","ZoomPanController","viewport","onZoomChange","onTransformChange","entries","entry","width","height","level","centerX","centerY","clamped","oldZoom","dx","dy","delta","resetLevel","maxPanX","maxPanY","onEnd","PAN_THRESHOLD","ZoomGestures","zoomPan","scrollHintCallback","ge","startX","startY","totalDx","totalDy","t1","t2","scale","PLUS_ICON","MINUS_ICON","RESET_ICON","createZoomControls","events","wrapper","zoomInBtn","zoomOutBtn","resetBtn","ScrollHint","isMac","createLabels","beforeText","afterText","posClass","beforeLabel","afterLabel","updateLabelVisibility","fadeThreshold","MAXIMIZE_ICON","MINIMIZE_ICON","FullscreenManager","onFullscreenChange","fsElement","wasActive","_b","EntranceAnimation","duration","delay","easing","onAnimate","KeyboardHandler","step","largeStep","zoomEnabled","_c","_d","_e","_f","current","increment","newPosition","updateAriaValue","setContainerAria","CIBeforeAfterCore","userConfig","percent","newConfig","_g","_h","oldConfig","beforeSrcChanged","afterSrcChanged","cloudimageChanged","shallowEqual","controls","_i","_j","_k","c","orientClass","beforeImage","clip","afterImage","handleGrip","pos","isFullscreen","safeCall","startPosition","skipTransition","beforeChanged","afterChanged","beforeLoaded","afterLoaded","checkReady","onBeforeLoad","onAfterLoad","onBeforeError","onAfterError","naturalWidth","naturalHeight","pan","size","hadFocus","newBeforeSrc","newAfterSrc","fn","args","err","a","b","keysA","keysB","CIBeforeAfter","root","cssText","elements","instances"],"mappings":"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"}