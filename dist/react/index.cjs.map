{"version":3,"file":"index.cjs","sources":["../../src/react/ci-before-after-viewer.tsx","../../src/react/use-ci-before-after.ts"],"sourcesContent":["import { forwardRef, useRef, useEffect, useImperativeHandle } from 'react';\nimport type { CIBeforeAfterViewerProps, CIBeforeAfterViewerRef } from './types';\nimport type { CIBeforeAfterConfig, CIBeforeAfterInstance } from '../core/types';\n\nexport const CIBeforeAfterViewer = forwardRef<CIBeforeAfterViewerRef, CIBeforeAfterViewerProps>(\n  function CIBeforeAfterViewer(props, ref) {\n    const {\n      className,\n      style,\n      onSlide,\n      onZoom,\n      onFullscreenChange,\n      onReady,\n      ...configProps\n    } = props;\n\n    const containerRef = useRef<HTMLDivElement>(null);\n    const instanceRef = useRef<CIBeforeAfterInstance | null>(null);\n    const pendingConfigRef = useRef<Partial<CIBeforeAfterConfig> | null>(null);\n\n    useImperativeHandle(ref, () => ({\n      getElements: () => {\n        if (!instanceRef.current) throw new Error('CIBeforeAfter: instance not yet initialized');\n        return instanceRef.current.getElements();\n      },\n      setPosition: (p: number) => instanceRef.current?.setPosition(p),\n      getPosition: () => instanceRef.current?.getPosition() ?? 50,\n      setZoom: (l: number) => instanceRef.current?.setZoom(l),\n      getZoom: () => instanceRef.current?.getZoom() ?? 1,\n      resetZoom: () => instanceRef.current?.resetZoom(),\n      enterFullscreen: () => instanceRef.current?.enterFullscreen(),\n      exitFullscreen: () => instanceRef.current?.exitFullscreen(),\n      isFullscreen: () => instanceRef.current?.isFullscreen() ?? false,\n      update: (c: Partial<CIBeforeAfterConfig>) => instanceRef.current?.update(c),\n      destroy: () => instanceRef.current?.destroy(),\n    }));\n\n    useEffect(() => {\n      if (!containerRef.current) return;\n\n      let cancelled = false;\n      let inst: CIBeforeAfterInstance | null = null;\n\n      import('../core/ci-before-after').then(\n        ({ CIBeforeAfterCore }) => {\n          // BUG-04: Guard against mount/unmount race\n          if (cancelled || !containerRef.current) return;\n\n          const config: CIBeforeAfterConfig = {\n            ...configProps,\n            onSlide,\n            onZoom,\n            onFullscreenChange,\n            onReady,\n          };\n\n          inst = new CIBeforeAfterCore(containerRef.current, config);\n          instanceRef.current = inst;\n\n          // Apply any config changes that arrived during async import\n          if (pendingConfigRef.current) {\n            inst.update(pendingConfigRef.current);\n            pendingConfigRef.current = null;\n          }\n        },\n        () => { /* dynamic import failed — component stays empty */ },\n      );\n\n      return () => {\n        cancelled = true;\n        inst?.destroy();\n        instanceRef.current = null;\n      };\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    // Update on prop changes\n    useEffect(() => {\n      const config: Partial<CIBeforeAfterConfig> = {\n        ...configProps,\n        onSlide,\n        onZoom,\n        onFullscreenChange,\n        onReady,\n      };\n\n      if (!instanceRef.current) {\n        // Instance not yet initialized — store for later application\n        pendingConfigRef.current = config;\n        return;\n      }\n\n      instanceRef.current.update(config);\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [\n      configProps.beforeSrc,\n      configProps.afterSrc,\n      configProps.beforeAlt,\n      configProps.afterAlt,\n      configProps.mode,\n      configProps.orientation,\n      configProps.initialPosition,\n      configProps.zoom,\n      configProps.zoomMax,\n      configProps.zoomMin,\n      configProps.theme,\n      configProps.handleStyle,\n      configProps.labels,\n      configProps.labelPosition,\n      configProps.fullscreenButton,\n      configProps.lazyLoad,\n      configProps.zoomControls,\n      configProps.zoomControlsPosition,\n      configProps.scrollHint,\n      configProps.keyboardStep,\n      configProps.keyboardLargeStep,\n      configProps.animate,\n      configProps.animateOnce,\n      configProps.cloudimage,\n      onSlide,\n      onZoom,\n      onFullscreenChange,\n      onReady,\n    ]);\n\n    return <div ref={containerRef} className={className} style={style} />;\n  },\n);\n","import { useRef, useEffect } from 'react';\nimport type { CIBeforeAfterConfig, CIBeforeAfterInstance } from '../core/types';\n\nexport function useCIBeforeAfter(config: CIBeforeAfterConfig) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const instance = useRef<CIBeforeAfterInstance | null>(null);\n  const pendingConfigRef = useRef<Partial<CIBeforeAfterConfig> | null>(null);\n\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    let cancelled = false;\n    let inst: CIBeforeAfterInstance | null = null;\n\n    import('../core/ci-before-after').then(\n      ({ CIBeforeAfterCore }) => {\n        // BUG-04: Guard against mount/unmount race\n        if (cancelled || !containerRef.current) return;\n        inst = new CIBeforeAfterCore(containerRef.current, config);\n        instance.current = inst;\n\n        // Apply any config changes that arrived during async import\n        if (pendingConfigRef.current) {\n          inst.update(pendingConfigRef.current);\n          pendingConfigRef.current = null;\n        }\n      },\n      () => { /* dynamic import failed — hook stays empty */ },\n    );\n\n    return () => {\n      cancelled = true;\n      inst?.destroy();\n      instance.current = null;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Update config when props change\n  useEffect(() => {\n    if (!instance.current) {\n      // Instance not yet initialized — store for later application\n      pendingConfigRef.current = config;\n      return;\n    }\n    instance.current.update(config);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    config.beforeSrc,\n    config.afterSrc,\n    config.beforeAlt,\n    config.afterAlt,\n    config.mode,\n    config.orientation,\n    config.initialPosition,\n    config.zoom,\n    config.zoomMax,\n    config.zoomMin,\n    config.theme,\n    config.handleStyle,\n    config.labels,\n    config.labelPosition,\n    config.fullscreenButton,\n    config.lazyLoad,\n    config.zoomControls,\n    config.zoomControlsPosition,\n    config.scrollHint,\n    config.keyboardStep,\n    config.keyboardLargeStep,\n    config.animate,\n    config.animateOnce,\n    config.cloudimage,\n    config.onSlide,\n    config.onZoom,\n    config.onFullscreenChange,\n    config.onReady,\n  ]);\n\n  return { containerRef, instance };\n}\n"],"names":["CIBeforeAfterViewer","forwardRef","props","ref","className","style","onSlide","onZoom","onFullscreenChange","onReady","configProps","containerRef","useRef","instanceRef","pendingConfigRef","useImperativeHandle","p","_a","l","c","useEffect","cancelled","inst","CIBeforeAfterCore","config","jsx","useCIBeforeAfter","instance"],"mappings":"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"}