{"version":3,"file":"index.js","sources":["../../src/react/ci-before-after-viewer.tsx","../../src/react/use-ci-before-after.ts"],"sourcesContent":["import { forwardRef, useRef, useEffect, useImperativeHandle } from 'react';\nimport type { CIBeforeAfterViewerProps, CIBeforeAfterViewerRef } from './types';\nimport type { CIBeforeAfterConfig, CIBeforeAfterInstance } from '../core/types';\n\nexport const CIBeforeAfterViewer = forwardRef<CIBeforeAfterViewerRef, CIBeforeAfterViewerProps>(\n  function CIBeforeAfterViewer(props, ref) {\n    const {\n      className,\n      style,\n      onSlide,\n      onZoom,\n      onFullscreenChange,\n      onReady,\n      ...configProps\n    } = props;\n\n    const containerRef = useRef<HTMLDivElement>(null);\n    const instanceRef = useRef<CIBeforeAfterInstance | null>(null);\n    const pendingConfigRef = useRef<Partial<CIBeforeAfterConfig> | null>(null);\n\n    useImperativeHandle(ref, () => ({\n      getElements: () => {\n        if (!instanceRef.current) throw new Error('CIBeforeAfter: instance not yet initialized');\n        return instanceRef.current.getElements();\n      },\n      setPosition: (p: number) => instanceRef.current?.setPosition(p),\n      getPosition: () => instanceRef.current?.getPosition() ?? 50,\n      setZoom: (l: number) => instanceRef.current?.setZoom(l),\n      getZoom: () => instanceRef.current?.getZoom() ?? 1,\n      resetZoom: () => instanceRef.current?.resetZoom(),\n      enterFullscreen: () => instanceRef.current?.enterFullscreen(),\n      exitFullscreen: () => instanceRef.current?.exitFullscreen(),\n      isFullscreen: () => instanceRef.current?.isFullscreen() ?? false,\n      update: (c: Partial<CIBeforeAfterConfig>) => instanceRef.current?.update(c),\n      destroy: () => instanceRef.current?.destroy(),\n    }));\n\n    useEffect(() => {\n      if (!containerRef.current) return;\n\n      let cancelled = false;\n      let inst: CIBeforeAfterInstance | null = null;\n\n      import('../core/ci-before-after').then(\n        ({ CIBeforeAfterCore }) => {\n          // BUG-04: Guard against mount/unmount race\n          if (cancelled || !containerRef.current) return;\n\n          const config: CIBeforeAfterConfig = {\n            ...configProps,\n            onSlide,\n            onZoom,\n            onFullscreenChange,\n            onReady,\n          };\n\n          inst = new CIBeforeAfterCore(containerRef.current, config);\n          instanceRef.current = inst;\n\n          // Apply any config changes that arrived during async import\n          if (pendingConfigRef.current) {\n            inst.update(pendingConfigRef.current);\n            pendingConfigRef.current = null;\n          }\n        },\n        () => { /* dynamic import failed — component stays empty */ },\n      );\n\n      return () => {\n        cancelled = true;\n        inst?.destroy();\n        instanceRef.current = null;\n      };\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n\n    // Update on prop changes\n    useEffect(() => {\n      const config: Partial<CIBeforeAfterConfig> = {\n        ...configProps,\n        onSlide,\n        onZoom,\n        onFullscreenChange,\n        onReady,\n      };\n\n      if (!instanceRef.current) {\n        // Instance not yet initialized — store for later application\n        pendingConfigRef.current = config;\n        return;\n      }\n\n      instanceRef.current.update(config);\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [\n      configProps.beforeSrc,\n      configProps.afterSrc,\n      configProps.beforeAlt,\n      configProps.afterAlt,\n      configProps.mode,\n      configProps.orientation,\n      configProps.initialPosition,\n      configProps.zoom,\n      configProps.zoomMax,\n      configProps.zoomMin,\n      configProps.theme,\n      configProps.handleStyle,\n      configProps.labels,\n      configProps.labelPosition,\n      configProps.fullscreenButton,\n      configProps.lazyLoad,\n      configProps.zoomControls,\n      configProps.zoomControlsPosition,\n      configProps.scrollHint,\n      configProps.keyboardStep,\n      configProps.keyboardLargeStep,\n      configProps.animate,\n      configProps.animateOnce,\n      configProps.cloudimage,\n      onSlide,\n      onZoom,\n      onFullscreenChange,\n      onReady,\n    ]);\n\n    return <div ref={containerRef} className={className} style={style} />;\n  },\n);\n","import { useRef, useEffect } from 'react';\nimport type { CIBeforeAfterConfig, CIBeforeAfterInstance } from '../core/types';\n\nexport function useCIBeforeAfter(config: CIBeforeAfterConfig) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const instance = useRef<CIBeforeAfterInstance | null>(null);\n  const pendingConfigRef = useRef<Partial<CIBeforeAfterConfig> | null>(null);\n\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    let cancelled = false;\n    let inst: CIBeforeAfterInstance | null = null;\n\n    import('../core/ci-before-after').then(\n      ({ CIBeforeAfterCore }) => {\n        // BUG-04: Guard against mount/unmount race\n        if (cancelled || !containerRef.current) return;\n        inst = new CIBeforeAfterCore(containerRef.current, config);\n        instance.current = inst;\n\n        // Apply any config changes that arrived during async import\n        if (pendingConfigRef.current) {\n          inst.update(pendingConfigRef.current);\n          pendingConfigRef.current = null;\n        }\n      },\n      () => { /* dynamic import failed — hook stays empty */ },\n    );\n\n    return () => {\n      cancelled = true;\n      inst?.destroy();\n      instance.current = null;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // Update config when props change\n  useEffect(() => {\n    if (!instance.current) {\n      // Instance not yet initialized — store for later application\n      pendingConfigRef.current = config;\n      return;\n    }\n    instance.current.update(config);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    config.beforeSrc,\n    config.afterSrc,\n    config.beforeAlt,\n    config.afterAlt,\n    config.mode,\n    config.orientation,\n    config.initialPosition,\n    config.zoom,\n    config.zoomMax,\n    config.zoomMin,\n    config.theme,\n    config.handleStyle,\n    config.labels,\n    config.labelPosition,\n    config.fullscreenButton,\n    config.lazyLoad,\n    config.zoomControls,\n    config.zoomControlsPosition,\n    config.scrollHint,\n    config.keyboardStep,\n    config.keyboardLargeStep,\n    config.animate,\n    config.animateOnce,\n    config.cloudimage,\n    config.onSlide,\n    config.onZoom,\n    config.onFullscreenChange,\n    config.onReady,\n  ]);\n\n  return { containerRef, instance };\n}\n"],"names":["CIBeforeAfterViewer","forwardRef","props","ref","className","style","onSlide","onZoom","onFullscreenChange","onReady","configProps","containerRef","useRef","instanceRef","pendingConfigRef","useImperativeHandle","p","_a","l","c","useEffect","cancelled","inst","CIBeforeAfterCore","config","jsx","useCIBeforeAfter","instance"],"mappings":";;AAIO,MAAMA,IAAsBC;AAAA,EACjC,SAA6BC,GAAOC,GAAK;AACvC,UAAM;AAAA,MACJ,WAAAC;AAAA,MACA,OAAAC;AAAA,MACA,SAAAC;AAAA,MACA,QAAAC;AAAA,MACA,oBAAAC;AAAA,MACA,SAAAC;AAAA,MACA,GAAGC;AAAA,IAAA,IACDR,GAEES,IAAeC,EAAuB,IAAI,GAC1CC,IAAcD,EAAqC,IAAI,GACvDE,IAAmBF,EAA4C,IAAI;AAEzE,WAAAG,EAAoBZ,GAAK,OAAO;AAAA,MAC9B,aAAa,MAAM;AACjB,YAAI,CAACU,EAAY,QAAS,OAAM,IAAI,MAAM,6CAA6C;AACvF,eAAOA,EAAY,QAAQ,YAAA;AAAA,MAC7B;AAAA,MACA,aAAa,CAACG,MAAA;;AAAc,gBAAAC,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB,YAAYD;AAAA;AAAA,MAC7D,aAAa,MAAA;;AAAM,iBAAAC,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB,kBAAiB;AAAA;AAAA,MACzD,SAAS,CAACC,MAAA;;AAAc,gBAAAD,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB,QAAQC;AAAA;AAAA,MACrD,SAAS,MAAA;;AAAM,iBAAAD,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB,cAAa;AAAA;AAAA,MACjD,WAAW,MAAA;;AAAM,gBAAAA,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB;AAAA;AAAA,MACtC,iBAAiB,MAAA;;AAAM,gBAAAA,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB;AAAA;AAAA,MAC5C,gBAAgB,MAAA;;AAAM,gBAAAA,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB;AAAA;AAAA,MAC3C,cAAc,MAAA;;AAAM,iBAAAA,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB,mBAAkB;AAAA;AAAA,MAC3D,QAAQ,CAACE,MAAA;;AAAoC,gBAAAF,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB,OAAOE;AAAA;AAAA,MACzE,SAAS,MAAA;;AAAM,gBAAAF,IAAAJ,EAAY,YAAZ,gBAAAI,EAAqB;AAAA;AAAA,IAAQ,EAC5C,GAEFG,EAAU,MAAM;AACd,UAAI,CAACT,EAAa,QAAS;AAE3B,UAAIU,IAAY,IACZC,IAAqC;AAEzC,oBAAO,8BAAyB,EAAE;AAAA,QAChC,CAAC,EAAE,mBAAAC,EAAA,MAAwB;AAEzB,cAAIF,KAAa,CAACV,EAAa,QAAS;AAExC,gBAAMa,IAA8B;AAAA,YAClC,GAAGd;AAAA,YACH,SAAAJ;AAAA,YACA,QAAAC;AAAA,YACA,oBAAAC;AAAA,YACA,SAAAC;AAAA,UAAA;AAGF,UAAAa,IAAO,IAAIC,EAAkBZ,EAAa,SAASa,CAAM,GACzDX,EAAY,UAAUS,GAGlBR,EAAiB,YACnBQ,EAAK,OAAOR,EAAiB,OAAO,GACpCA,EAAiB,UAAU;AAAA,QAE/B;AAAA,QACA,MAAM;AAAA,QAAsD;AAAA,MAAA,GAGvD,MAAM;AACX,QAAAO,IAAY,IACZC,KAAA,QAAAA,EAAM,WACNT,EAAY,UAAU;AAAA,MACxB;AAAA,IAEF,GAAG,CAAA,CAAE,GAGLO,EAAU,MAAM;AACd,YAAMI,IAAuC;AAAA,QAC3C,GAAGd;AAAA,QACH,SAAAJ;AAAA,QACA,QAAAC;AAAA,QACA,oBAAAC;AAAA,QACA,SAAAC;AAAA,MAAA;AAGF,UAAI,CAACI,EAAY,SAAS;AAExB,QAAAC,EAAiB,UAAUU;AAC3B;AAAA,MACF;AAEA,MAAAX,EAAY,QAAQ,OAAOW,CAAM;AAAA,IAEnC,GAAG;AAAA,MACDd,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZA,EAAY;AAAA,MACZJ;AAAA,MACAC;AAAA,MACAC;AAAA,MACAC;AAAA,IAAA,CACD,GAEM,gBAAAgB,EAAC,OAAA,EAAI,KAAKd,GAAc,WAAAP,GAAsB,OAAAC,GAAc;AAAA,EACrE;AACF;AC5HO,SAASqB,EAAiBF,GAA6B;AAC5D,QAAMb,IAAeC,EAAuB,IAAI,GAC1Ce,IAAWf,EAAqC,IAAI,GACpDE,IAAmBF,EAA4C,IAAI;AAEzE,SAAAQ,EAAU,MAAM;AACd,QAAI,CAACT,EAAa,QAAS;AAE3B,QAAIU,IAAY,IACZC,IAAqC;AAEzC,kBAAO,8BAAyB,EAAE;AAAA,MAChC,CAAC,EAAE,mBAAAC,EAAA,MAAwB;AAEzB,QAAIF,KAAa,CAACV,EAAa,YAC/BW,IAAO,IAAIC,EAAkBZ,EAAa,SAASa,CAAM,GACzDG,EAAS,UAAUL,GAGfR,EAAiB,YACnBQ,EAAK,OAAOR,EAAiB,OAAO,GACpCA,EAAiB,UAAU;AAAA,MAE/B;AAAA,MACA,MAAM;AAAA,MAAiD;AAAA,IAAA,GAGlD,MAAM;AACX,MAAAO,IAAY,IACZC,KAAA,QAAAA,EAAM,WACNK,EAAS,UAAU;AAAA,IACrB;AAAA,EAEF,GAAG,CAAA,CAAE,GAGLP,EAAU,MAAM;AACd,QAAI,CAACO,EAAS,SAAS;AAErB,MAAAb,EAAiB,UAAUU;AAC3B;AAAA,IACF;AACA,IAAAG,EAAS,QAAQ,OAAOH,CAAM;AAAA,EAEhC,GAAG;AAAA,IACDA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,IACPA,EAAO;AAAA,EAAA,CACR,GAEM,EAAE,cAAAb,GAAc,UAAAgB,EAAA;AACzB;"}